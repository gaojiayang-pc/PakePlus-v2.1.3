<!DOCTYPE html>
<html lang="zh-CN" data-theme="glass_pro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title data-i18n="title">Timer V34.0 (Ultimate)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Roboto+Mono:wght@500;700&family=Comic+Neue:wght+700&family=JetBrains+Mono:wght+700&family=VT323&family=Orbitron:wght+700&display=swap" rel="stylesheet">
    
    <style>
        /* ... (Your existing CSS remains unchanged) ... */
        /* ======================================================= */
        /* === 1. å…¨å±€å˜é‡ & ä¸»é¢˜é…ç½® === */
        /* ======================================================= */
        :root {
            --timer-scale: 1.0;
            --custom-text: initial; --custom-accent: initial;
            --sidebar-width: 340px; --bg-mask-opacity: 0;
            --grid-size: 160px; --icon-size: 3.5rem; --radius: 20px;
            --safe-top: env(safe-area-inset-top);
        }

        /* --- åŸºç¡€ä¸»é¢˜ --- */
        [data-theme="ios"] { --bg:#F2F2F7; --card-bg:rgba(255,255,255,0.85); --card-border:none; --shadow:0 4px 12px rgba(0,0,0,0.05); --text-main:#1C1C1E; --accent:#007AFF; --radius-def:20px; --font-ui:'Inter'; --font-num:'Inter'; --backdrop:blur(20px); }
        [data-theme="bauhaus"] { --bg:#e6e6e6; --card-bg:#ffffff; --card-border:3px solid #121212; --shadow:6px 6px 0px #121212; --text-main:#121212; --accent:#D92B2B; --radius-def:0px; --font-ui:'Inter'; --font-num:'JetBrains Mono'; --backdrop:none; }
        [data-theme="glass_pro"] { --bg: #0f0c29; --card-bg: rgba(255, 255, 255, 0.05); --card-border: 1px solid rgba(255, 255, 255, 0.15); --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); --text-main: #ffffff; --accent: #00d2ff; --radius-def: 24px; --font-ui: 'Inter'; --font-num: 'Inter'; --backdrop: blur(20px) saturate(180%); }
        [data-theme="glass_pro"] #base-bg-layer { background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); background-size: 400% 400%; animation: gradientBG 15s ease infinite; }
        [data-theme="glass_pro"] #custom-bg-layer::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(76,29,149,0.4) 0%, transparent 60%), radial-gradient(circle, rgba(56,189,248,0.3) 0%, transparent 50%); background-position: 0 0, 100% 100%; animation: rotateBlob 20s linear infinite; z-index: -1; }

        /* èµ›åšæœ‹å…‹ */
        [data-theme="cyberpunk"] {
            --bg: #050505; --card-bg: rgba(10, 10, 10, 0.9); --card-border: 2px solid #00ff9f; 
            --shadow: 0 0 15px rgba(0, 255, 159, 0.2), inset 0 0 10px rgba(0, 255, 159, 0.1); 
            --text-main: #00ff9f; --accent: #ff0055; --radius-def: 0px; 
            --font-ui: 'Orbitron', sans-serif; --font-num: 'VT323'; --backdrop: none;
        }
        [data-theme="cyberpunk"] #base-bg-layer {
            background-color: #050505;
            background-image: linear-gradient(rgba(0, 255, 159, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 159, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* å…¶ä»–ä¸»é¢˜ */
        [data-theme="retro95"] { --bg:#008080; --card-bg:#C0C0C0; --card-border:2px outset #fff; --shadow:2px 2px 0 #000; --text-main:#000; --accent:#000080; --radius-def:0px; --font-ui:'VT323'; --font-num:'VT323'; --backdrop:none; }
        [data-theme="win10"] { --bg:#1F1F1F; --card-bg:rgba(40,40,40,0.95); --card-border:1px solid rgba(255,255,255,0.1); --shadow:0 4px 20px rgba(0,0,0,0.5); --text-main:#FFF; --accent:#0078D7; --radius-def:0px; --font-ui:'Segoe UI'; --font-num:'Segoe UI'; --backdrop:blur(30px); }
        [data-theme="neo"] { --bg:#E0E5EC; --card-bg:#E0E5EC; --card-border:none; --shadow:9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255,0.5); --text-main:#4A4A4A; --accent:#6C5CE7; --radius-def:30px; --font-ui:'Inter'; --font-num:'Inter'; --backdrop:none; }
        [data-theme="mini"] { --bg:#FAFAFA; --card-bg:#FFFFFF; --card-border:1px solid #EAEAEA; --shadow:0 2px 4px rgba(0,0,0,0.02); --text-main:#111; --accent:#000; --radius-def:0px; --font-ui:'Inter'; --font-num:'Inter'; --backdrop:none; }
        [data-theme="cartoon"] { --bg:#85FFBD; --card-bg:#FFF; --card-border:3px solid #000; --shadow:0 6px 0 rgba(0,0,0,0.15); --text-main:#000; --accent:#FF6B6B; --radius-def:25px; --font-ui:'Comic Neue'; --font-num:'Comic Neue'; --backdrop:none; }
        [data-theme="darkglass"] { --bg:#121212; --card-bg:rgba(255,255,255,0.08); --card-border:1px solid rgba(255,255,255,0.15); --shadow:0 8px 32px rgba(0,0,0,0.5); --text-main:#E0E0E0; --accent:#BB86FC; --radius-def:16px; --font-ui:'Inter'; --font-num:'Inter'; --backdrop:blur(24px); }

        [data-theme="bauhaus"] #base-bg-layer { background-image: radial-gradient(circle at 10% 20%, rgba(217, 43, 43, 0.1) 10%, transparent 11%), radial-gradient(circle at 90% 80%, rgba(30, 55, 153, 0.1) 15%, transparent 16%), linear-gradient(45deg, #e6e6e6 25%, transparent 25%, transparent 75%, #e6e6e6 75%, #e6e6e6), linear-gradient(45deg, #e6e6e6 25%, transparent 25%, transparent 75%, #e6e6e6 75%, #e6e6e6); background-position: 0 0, 0 0, 0 0, 20px 20px; background-size: 100% 100%, 100% 100%, 40px 40px, 40px 40px; }
        
        @keyframes gradientBG { 0% {background-position:0% 50%} 50% {background-position:100% 50%} 100% {background-position:0% 50%} }
        @keyframes rotateBlob { 0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);} }
        
        /* ... (The rest of your existing CSS) ... */
    </style>
</head>
<body>

    <audio id="sfx-ding" src="https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/ding.mp3"></audio>
    <audio id="sfx-bell" src="https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/bell.mp3"></audio>

    <div id="toast-container" style="position:fixed; top:80px; left:50%; transform:translateX(-50%); z-index:9999; display:flex; flex-direction:column; gap:10px; pointer-events: none;"></div>

    <div id="base-bg-layer" class="layer-fixed"></div>
    <div id="custom-bg-layer" class="layer-fixed"></div>
    <div id="bg-mask-layer" class="layer-fixed"></div>
    <div id="atmosphere-layer" class="layer-fixed"></div>

    <!-- Sidebar -->
    <div id="sidebar-overlay" onclick="View.toggleSidebar()"></div>
    <div id="theme-sidebar">
        <div id="sidebar-resizer"></div>
        <div class="sidebar-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0; font-size:1.5rem;" data-i18n="settings_title">è®¾ç½®</h2>
                <button onclick="View.toggleSidebar()" style="padding:5px 10px; background:transparent; border:none; font-size:1.2rem;">âœ•</button>
            </div>
            <!-- Language Switch Added Here -->
            <button id="lang-switch-btn" onclick="App.toggleLanguage()" class="menu-btn" style="width:100%; margin-bottom: 20px;">
                Language: EN
            </button>

            <label style="font-weight:bold; display:block; margin-bottom:10px;" data-i18n="icon_style">å›¾æ ‡é£æ ¼</label>
            <div class="mode-switcher">
                <button class="mode-btn icon-type-btn" onclick="App.setIconType('emoji', this)">Emoji ğŸ¨</button>
                <button class="mode-btn icon-type-btn" onclick="App.setIconType('line', this)">Line âœï¸</button>
                <button class="mode-btn icon-type-btn" onclick="App.setIconType('solid', this)">Solid â¬›</button>
                <button class="mode-btn icon-type-btn" onclick="App.setIconType('duotone', this)">Duo ğŸŒ—</button>
            </div>
            <label style="font-weight:bold; display:block; margin-bottom:10px;" data-i18n="layout_mode">å¸ƒå±€æ¨¡å¼</label>
            <div class="mode-switcher">
                <button class="mode-btn display-mode-btn" onclick="App.setMode('standard', this)" data-i18n="mode_standard">æ ‡å‡†</button>
                <button class="mode-btn display-mode-btn" onclick="App.setMode('icon', this)" data-i18n="mode_icon">å›¾æ ‡</button>
                <button class="mode-btn display-mode-btn" onclick="App.setMode('text', this)" data-i18n="mode_text">æ–‡å­—</button>
            </div>
            <div style="margin-bottom:20px; padding-bottom:15px; border-bottom:1px solid #ddd;">
                <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:5px;"><span data-i18n="icon_size">å›¾æ ‡å¤§å°</span><span id="icon-size-val">3rem</span></div>
                <input type="range" min="1.5" max="5.0" step="0.1" value="3.0" style="width:100%;" oninput="View.updateIconSize(this.value)">
                <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:5px; margin-top:10px;"><span data-i18n="card_radius">å¡ç‰‡åœ†è§’</span><span id="radius-val">--</span></div>
                <input type="range" min="0" max="40" step="1" value="20" style="width:100%;" oninput="View.updateRadius(this.value)">
            </div>
            <label style="font-weight:bold; display:block; margin-bottom:10px;" data-i18n="theme_style">ä¸»é¢˜é£æ ¼</label>
            <div class="theme-grid" id="theme-list"></div>
            <div style="margin-top:30px; padding-top:20px; border-top:1px solid #ddd;">
                <label style="font-weight:bold; display:block; margin-bottom:10px;" data-i18n="atmosphere_wallpaper">æ°›å›´ & å£çº¸</label>
                <div style="margin-bottom:15px;">
                     <label style="font-size:0.9rem; display:block; margin-bottom:5px;" data-i18n="particle_effect">ç²’å­ç‰¹æ•ˆ</label>
                     <select id="particle-select" onchange="BgEngine.changeStyle(this.value)" style="width:100%;">
                         <option value="float" data-i18n="p_float">ğŸˆ æ¼‚æµ® (æ°”æ³¡)</option>
                         <option value="rain" data-i18n="p_rain">ğŸŒ§ï¸ æš´é›¨ (å€¾æ–œ)</option>
                         <option value="snow" data-i18n="p_snow">â„ï¸ é£˜é›ª (æ‘‡æ‘†)</option>
                         <option value="breathe" data-i18n="p_breathe">ğŸ§˜ å‘¼å¸ (å…‰æ–‘)</option>
                         <option value="firefly" data-i18n="p_firefly">âœ¨ è¤ç« (æ¸¸èµ°)</option>
                         <option value="crazy" data-i18n="p_crazy">âš¡ æé€Ÿ (æ”¾å°„)</option>
                     </select>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <span data-i18n="show_particles">æ˜¾ç¤ºç²’å­</span>
                    <input type="checkbox" id="particle-check" checked onchange="BgEngine.toggleParticles(this.checked)">
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                     <span data-i18n="particle_count">ç²’å­æ•°é‡</span><span id="particle-count-val">20</span>
                </div>
                <input type="range" min="0" max="50" step="5" value="20" style="width:100%;" oninput="BgEngine.updateCount(this.value)">
                <div class="input-group-row" style="margin-top:20px;">
                    <input id="bg-input" class="input-compact" data-i18n="[placeholder]wallpaper_url" placeholder="å£çº¸ URL..." onchange="BgEngine.updateBg()">
                    <button class="btn-small" onclick="document.getElementById('bg-input').value='';BgEngine.updateBg()" data-i18n="clear">æ¸…é™¤</button>
                </div>
                <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin:10px 0 5px;"><span data-i18n="bg_mask">èƒŒæ™¯é®ç½©</span><span id="mask-val">0%</span></div>
                <input type="range" min="0" max="0.8" step="0.1" value="0" style="width:100%;" oninput="BgEngine.updateMask(this.value)">
            </div>
            <div style="margin-top:20px; padding-top:20px; border-top:1px solid #ddd; padding-bottom:100px;">
                <label style="font-weight:bold; display:block; margin-bottom:10px;" data-i18n="color_font">é…è‰² & å­—ä½“</label>
                <div style="display:flex; gap:10px; justify-content: center; margin-bottom:15px;">
                    <input type="color" onchange="document.documentElement.style.setProperty('--custom-text', this.value); localStorage.setItem('customText', this.value)" title="å­—ä½“è‰²" style="width:40px; height:40px; padding:0; border-radius:50%; overflow:hidden; border:none;">
                    <input type="color" onchange="document.documentElement.style.setProperty('--custom-accent', this.value); localStorage.setItem('customAccent', this.value)" title="ä¸»é¢˜è‰²" style="width:40px; height:40px; padding:0; border-radius:50%; overflow:hidden; border:none;">
                    <button class="btn-small" onclick="localStorage.clear();location.reload()" data-i18n="reset_settings">é‡ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Bar -->
    <div id="top-bar">
        <div style="display:flex; gap:10px;">
            <button class="menu-btn" onclick="View.toggleSidebar()">
                <span style="font-size:1.2rem;margin-right:5px;">ğŸ¨</span> <span data-i18n="settings_btn">è®¾ç½®</span>
            </button>
            <button id="btn-edit-home" class="menu-btn" onclick="App.toggleEdit(this)">
                ğŸ“ <span data-i18n="edit_btn">ç¼–è¾‘</span>
            </button>
            <button class="menu-btn" onclick="SoundEngine.togglePanel()" title="å£°æ™¯æ§åˆ¶">
                ğŸµ <span data-i18n="soundscape_btn">å£°æ™¯</span>
            </button>
        </div>
        <button id="btn-home" class="menu-btn hidden" onclick="App.goHome()">ğŸ  <span data-i18n="home_btn">ä¸»é¡µ</span></button>
        <div id="clock-real" style="font-family:var(--font-num); font-weight:700; background:var(--card-bg); padding:8px 15px; border-radius:20px; box-shadow:var(--shadow); border:var(--card-border); backdrop-filter:var(--backdrop);">00:00</div>
    </div>

    <div id="sound-panel">
        <h4 data-i18n="soundscape_audio_title">Atmosphere Audio (å£°æ™¯)</h4>
        <div class="sound-opt" onclick="SoundEngine.play('white')" data-i18n="noise_white">âšª ç™½å™ªéŸ³ (ä¸“æ³¨) <span class="status"></span></div>
        <div class="sound-opt" onclick="SoundEngine.play('pink')" data-i18n="noise_pink">ğŸŒ§ï¸ ç²‰å™ªéŸ³ (é›¨å£°) <span class="status"></span></div>
        <div class="sound-opt" onclick="SoundEngine.play('brown')" data-i18n="noise_brown">ğŸŒŠ çº¢å™ªéŸ³ (æ·±æµ·) <span class="status"></span></div>
        <div class="sound-opt" onclick="SoundEngine.stop()" data-i18n="noise_off">ğŸ”‡ å…³é—­æ‰€æœ‰ <span class="status"></span></div>
    </div>

    <div class="main-wrapper">
        <div id="page-home" class="page active">
            <div style="text-align:center; padding: 20px 0 40px;">
                <h1 style="font-size: 2.5rem; margin: 0; letter-spacing: -1px;" data-i18n="version_title">V34.0 Ultimate</h1>
                <p style="opacity:0.6;" data-i18n="version_features">æ–°å¢: äºŒç»´ç  Â· å•ä½æ¢ç®— Â· é—ªå¡</p>
            </div>
            
            <div class="home-grid" id="app-grid" data-mode="standard" data-icon="emoji"></div>
            
            <div id="hidden-apps-area" class="hidden-apps-area">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 style="opacity:0.7; margin:0;" data-i18n="hidden_apps_title">ğŸ“‚ éšè—åº”ç”¨æ”¶çº³ç›’</h3>
                    <button class="btn-small" style="font-size:0.8rem; padding:4px 8px;" onclick="App.resetLayout()" data-i18n="reset_layout">â†º æ¢å¤é»˜è®¤å¸ƒå±€</button>
                </div>
                <div class="home-grid" id="hidden-app-grid" data-mode="standard" data-icon="emoji"></div>
            </div>
        </div>
        
        <!-- NEW: Converter -->
        <div id="page-converter" class="page">
            <div class="timer-box">
                <h2 data-i18n="conv_title">ğŸ“ å•ä½æ¢ç®—</h2>
                <div style="text-align:center; margin-bottom:20px;">
                    <select id="conv-type" onchange="Modules.Converter.render()" style="width:100%; margin-bottom:20px;">
                        <option value="len" data-i18n="conv_len">é•¿åº¦ (Length)</option>
                        <option value="weight" data-i18n="conv_weight">é‡é‡ (Weight)</option>
                        <option value="temp" data-i18n="conv_temp">æ¸©åº¦ (Temp)</option>
                    </select>
                    <div class="conv-row">
                        <input id="conv-in" type="number" value="1" oninput="Modules.Converter.calc()">
                        <span data-i18n="conv_equals">=</span>
                        <div id="conv-out" class="conv-res">--</div>
                    </div>
                    <div class="conv-row">
                        <select id="conv-u1" onchange="Modules.Converter.calc()"></select>
                        <span data-i18n="conv_to">to</span>
                        <select id="conv-u2" onchange="Modules.Converter.calc()"></select>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: QR Code -->
        <div id="page-qr" class="page">
            <div class="timer-box">
                <h2 data-i18n="qr_title">ğŸ“± äºŒç»´ç ç”Ÿæˆ</h2>
                <div style="text-align:center;">
                    <input id="qr-input" data-i18n="[placeholder]qr_input_placeholder" placeholder="è¾“å…¥é“¾æ¥æˆ–æ–‡å­—..." style="width:100%; margin-bottom:10px;">
                    <button class="btn-primary" onclick="Modules.QR.gen()" data-i18n="qr_generate">ç”Ÿæˆ</button>
                    <img id="qr-image" src="" alt="QR Code">
                    <p style="opacity:0.5; font-size:0.8rem; margin-top:10px;">Powered by QRServer</p>
                </div>
            </div>
        </div>

        <!-- NEW: Flashcards -->
        <div id="page-cards" class="page">
            <div class="timer-box">
                <h2 data-i18n="cards_title">ğŸƒ è®°å¿†é—ªå¡</h2>
                <div id="card-wrap" class="card-container" onclick="this.querySelector('.flashcard').classList.toggle('flipped')">
                    <div class="flashcard">
                        <div class="card-face card-front" id="card-front" data-i18n="card_tap_start">ç‚¹å‡»å¼€å§‹</div>
                        <div class="card-face card-back" id="card-back" data-i18n="card_answer_back">ç­”æ¡ˆèƒŒé¢</div>
                    </div>
                </div>
                <div class="card-controls">
                    <button onclick="Modules.Cards.prev()">â¬…ï¸ <span data-i18n="card_prev">ä¸Šä¸€å¼ </span></button>
                    <span id="card-count" style="font-weight:bold; opacity:0.7;">0/0</span>
                    <button onclick="Modules.Cards.next()"><span data-i18n="card_next">ä¸‹ä¸€å¼ </span> â¡ï¸</button>
                </div>
                <div style="margin-top:20px; border-top:1px solid rgba(0,0,0,0.1); padding-top:20px;">
                    <div style="display:flex; gap:10px;">
                        <input id="card-q" data-i18n="[placeholder]card_q_placeholder" placeholder="é—®é¢˜ (æ­£é¢)" style="flex:1;">
                        <input id="card-a" data-i18n="[placeholder]card_a_placeholder" placeholder="ç­”æ¡ˆ (èƒŒé¢)" style="flex:1;">
                        <button class="btn-primary" onclick="Modules.Cards.add()">+</button>
                    </div>
                    <button class="btn-small" style="margin-top:10px;" onclick="Modules.Cards.clear()" data-i18n="card_clear">æ¸…ç©ºå¡ç‰‡</button>
                </div>
            </div>
        </div>

        <div id="page-calc" class="page">
            <div class="timer-box">
                <h2 data-i18n="calc_title">ğŸ§® è®¡ç®—å™¨</h2>
                <input id="calc-display" readonly value="0">
                <div class="calc-grid">
                    <button class="calc-btn" onclick="Modules.Calc.cls()">C</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('(')">(</button>
                    <button class="calc-btn" onclick="Modules.Calc.append(')')">)</button>
                    <button class="calc-btn op" onclick="Modules.Calc.append('/')">Ã·</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('7')">7</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('8')">8</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('9')">9</button>
                    <button class="calc-btn op" onclick="Modules.Calc.append('*')">Ã—</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('4')">4</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('5')">5</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('6')">6</button>
                    <button class="calc-btn op" onclick="Modules.Calc.append('-')">âˆ’</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('1')">1</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('2')">2</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('3')">3</button>
                    <button class="calc-btn op" onclick="Modules.Calc.append('+')">+</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('0')">0</button>
                    <button class="calc-btn" onclick="Modules.Calc.append('.')">.</button>
                    <button class="calc-btn eq" onclick="Modules.Calc.eq()">=</button>
                </div>
            </div>
        </div>

        <div id="page-breathe" class="page">
            <div class="timer-box">
                <h2 class="non-zen-content" data-i18n="breathe_title">ğŸ§˜ æ·±å‘¼å¸</h2>
                <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                    <div id="breath-circle" class="breath-circle">
                        <div id="breath-text" class="breath-state" data-i18n="breathe_inhale">å¸æ°”</div>
                    </div>
                    <p class="breath-guide" data-i18n="breathe_guide">4ç§’å¸æ°” - 7ç§’ä¿æŒ - 8ç§’å‘¼æ°”</p>
                </div>
                <div class="controls non-zen-content">
                    <button class="btn-primary" onclick="Modules.Breathe.start()" data-i18n="start">å¼€å§‹</button>
                    <button onclick="Modules.Breathe.stop()" data-i18n="stop">åœæ­¢</button>
                    <button onclick="View.toggleZen()" data-i18n="fullscreen">å…¨å±</button>
                </div>
            </div>
        </div>

        <div id="page-notes" class="page">
            <div class="timer-box">
                <h2 data-i18n="notes_title">ğŸ—’ï¸ ä¾¿ç­¾</h2>
                <textarea id="notes-area" data-i18n="[placeholder]notes_placeholder" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„æƒ³æ³•... (è‡ªåŠ¨ä¿å­˜)" oninput="Modules.Notes.save()"></textarea>
                <div style="margin-top:10px; display:flex; justify-content:flex-end;">
                     <button class="btn-small" onclick="document.getElementById('notes-area').value='';Modules.Notes.save()" data-i18n="clear">æ¸…ç©º</button>
                </div>
            </div>
        </div>

        <!-- Previous Pages -->
        <div id="page-exam" class="page"><div class="timer-box"><div class="non-zen-content" style="border-bottom:1px solid rgba(0,0,0,0.1); padding-bottom:20px; margin-bottom:20px;"><h2 style="width:100%; justify-content:center; margin-bottom:15px;" data-i18n="exam_title">ğŸ“ è€ƒåœºæ¨¡æ‹Ÿ</h2><div style="display:flex; gap:10px; justify-content:center;"><input id="ex-sub" value="é«˜ç­‰æ•°å­¦" data-i18n="[placeholder]exam_subject_placeholder" placeholder="ç§‘ç›®" style="width:140px; text-align:center;"><input id="ex-dur" type="number" value="120" style="width:70px; text-align:center;"> <span data-i18n="exam_min">åˆ†é’Ÿ</span></div></div><div class="exam-info"><h1 id="disp-sub" data-i18n="exam_subject_name">ç§‘ç›®åç§°</h1><p id="disp-status" data-i18n="exam_status_wait">ç­‰å¾…å¼€è€ƒ</p></div><div class="timer-container"><div class="time-display" id="exam-timer">00:00</div></div><div class="controls non-zen-content"><button class="btn-primary" onclick="Modules.Exam.start()" data-i18n="start">å¼€å§‹</button><button class="btn-accent hidden" id="btn-exam-stop" onclick="Modules.Exam.stop()" data-i18n="exam_end">ç»“æŸ</button><button onclick="View.toggleZen()" data-i18n="fullscreen">å…¨å±</button></div></div></div>
        <div id="page-pomo" class="page"><div class="timer-box" style="text-align:center;"><h2 class="non-zen-content" data-i18n="pomo_title">ğŸ… ç•ªèŒ„ä¸“æ³¨</h2><div class="timer-container" id="pomo-container"><svg class="progress-ring" viewBox="0 0 120 120"><circle r="52" cx="60" cy="60" fill="none"/></svg><div class="time-display" id="pomo-timer">25:00</div></div><div class="controls non-zen-content"><button class="btn-primary" onclick="Modules.Pomo.start()" data-i18n="start">å¼€å§‹</button><button onclick="Modules.Pomo.reset()" data-i18n="reset">é‡ç½®</button><button onclick="View.toggleZen()" data-i18n="fullscreen">å…¨å±</button></div></div></div>
        <div id="page-whiteboard" class="page"><div class="timer-box"><div id="wb-toolbar" class="non-zen-content"><h2 style="margin:0; font-size:1.2rem;" data-i18n="wb_title">ğŸ¨ ç™½æ¿</h2><div style="display:flex; gap:8px;"><button style="width:24px;height:24px;border-radius:50%;background:#000;" onclick="Modules.Whiteboard.color='#000'"></button><button style="width:24px;height:24px;border-radius:50%;background:#d63031;" onclick="Modules.Whiteboard.color='#d63031'"></button><button style="width:24px;height:24px;border-radius:50%;background:#0984e3;" onclick="Modules.Whiteboard.color='#0984e3'"></button><button style="width:24px;height:24px;border-radius:50%;background:#fff;border:1px solid #ccc;" onclick="Modules.Whiteboard.color='#fff';Modules.Whiteboard.width=20" data-i18n="[title]wb_eraser" title="æ©¡çš®æ“¦"></button></div><div style="display:flex; gap:5px;"><button class="btn-small" onclick="Modules.Whiteboard.clear()" data-i18n="clear">æ¸…ç©º</button><button class="btn-small" onclick="View.toggleZen()" data-i18n="fullscreen">å…¨å±</button></div></div><canvas id="wb-canvas" width="800" height="400"></canvas></div></div>
        <div id="page-media" class="page"><div class="timer-box"><h2 data-i18n="media_title">ğŸ“º åª’ä½“</h2><div class="media-drop-zone" onclick="document.getElementById('media-input').click()" data-i18n="media_placeholder" style="border:2px dashed rgba(0,0,0,0.2); padding:40px; text-align:center; border-radius:12px; cursor:pointer;">ğŸ“‚ é€‰æ‹©è§†é¢‘/éŸ³é¢‘æ–‡ä»¶<input type="file" id="media-input" hidden accept="video/*,audio/*" onchange="Modules.Media.load(this)"></div><div id="media-container" class="hidden" style="margin-top:20px;"><video id="video-player" controls style="width:100%; border-radius:12px; background:#000;"></video></div></div></div>
        <div id="page-schedule" class="page"><div class="timer-box"><h2 data-i18n="schedule_title">ğŸ“… æ—¥ç¨‹</h2><div id="schedule-list" style="margin:20px 0;"></div><div class="controls"><button onclick="Modules.Schedule.add()" data-i18n="schedule_add">+ æ·»åŠ </button><button class="btn-accent" onclick="Modules.Schedule.clear()" data-i18n="clear">æ¸…ç©º</button></div></div></div>
        <div id="page-countdown" class="page"><div class="timer-box"><h2 class="non-zen-content" data-i18n="countdown_title">â±ï¸ å€’è®¡æ—¶</h2><div class="controls non-zen-content" style="text-align:center;"><input id="cd-input" type="number" value="10" style="width:60px;text-align:center;"> <span data-i18n="exam_min">åˆ†</span></div><div class="timer-container" id="cd-container"><svg class="progress-ring" viewBox="0 0 120 120"><circle r="52" cx="60" cy="60" fill="none"/></svg><div class="time-display" id="cd-timer">10:00</div></div><div class="controls non-zen-content" style="text-align:center;"><button class="btn-primary" onclick="Modules.Countdown.start()" data-i18n="start">å¼€å§‹</button><button onclick="View.toggleZen()" data-i18n="fullscreen">å…¨å±</button></div></div></div>
        <div id="page-stopwatch" class="page"><div class="timer-box"><h2 class="non-zen-content" data-i18n="stopwatch_title">â²ï¸ ç§’è¡¨</h2><div class="timer-container"><div class="time-display" id="sw-timer">00:00.00</div></div><div class="controls non-zen-content" style="text-align:center;"><button class="btn-primary" onclick="Modules.Stopwatch.start()" data-i18n="start">å¼€å§‹</button><button onclick="Modules.Stopwatch.pause()" data-i18n="pause">æš‚åœ</button><button class="btn-accent" onclick="Modules.Stopwatch.reset()" data-i18n="clear_to_zero">æ¸…é›¶</button><button onclick="View.toggleZen()" data-i18n="fullscreen">å…¨å±</button></div></div></div>
        <div id="page-todo" class="page"><div class="timer-box"><h2 data-i18n="todo_title">âœ… å¾…åŠ</h2><div style="display:flex;gap:10px;margin:20px 0;"><input id="todo-input" class="input-compact" data-i18n="[placeholder]todo_input_placeholder" style="flex:1"><button class="btn-primary" onclick="Modules.Todo.add()" data-i18n="todo_add">æ·»åŠ </button></div><div id="todo-list"></div></div></div>
        <div id="page-favs" class="page"><div class="timer-box"><h2 data-i18n="favs_title">â­ æ”¶è—</h2><div id="fav-list" style="margin:20px 0;"></div><div class="controls" style="display:flex;gap:5px;"><input id="fav-name" data-i18n="[placeholder]fav_name_placeholder" placeholder="å" style="width:30%"><input id="fav-url" placeholder="URL" style="flex:1"><button class="btn-primary" onclick="Modules.Favs.add()" data-i18n="fav_save">å­˜</button></div></div></div>
        <div id="page-stats" class="page"><div class="timer-box"><h2 data-i18n="stats_title">ğŸ“Š ç»Ÿè®¡</h2><div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;text-align:center;"><div style="background:rgba(0,0,0,0.05);padding:20px;border-radius:10px;"><div data-i18n="stat_total">æ€»æ¬¡æ•°</div><div id="stat-total" style="font-size:2em;font-weight:bold;">0</div></div><div style="background:rgba(0,0,0,0.05);padding:20px;border-radius:10px;"><div data-i18n="stat_today">ä»Šæ—¥(åˆ†)</div><div id="stat-today" style="font-size:2em;font-weight:bold;">0</div></div></div></div></div>
        <div id="page-long" class="page"><div class="timer-box"><h2 data-i18n="long_title">ğŸ¯ ç›®æ ‡</h2><div style="text-align:center;margin-top:20px;"><h3 data-i18n="long_target_custom">è‡ªå®šä¹‰ç›®æ ‡</h3><div id="target-display" style="font-size:2em;margin:10px 0;font-weight:bold;">--</div><input type="datetime-local" id="target-input" onchange="Modules.Long.set('target')" style="max-width:100%;"></div></div></div>
        <div id="page-account" class="page"><div class="timer-box"><h2 data-i18n="data_title">ğŸ’¾ æ•°æ®</h2><div class="controls" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;"><button onclick="Data.export()" data-i18n="data_export">å¯¼å‡ºJSON</button><button onclick="document.getElementById('file-in').click()" data-i18n="data_import">å¯¼å…¥JSON</button><input type="file" id="file-in" hidden onchange="Data.import(this)"></div><button class="btn-accent" style="margin-top:20px;width:100%;color:red;border-color:red;background:rgba(255,0,0,0.1);" onclick="if(confirm(App.i18n('data_clear_confirm'))) {localStorage.clear();location.reload();}" data-i18n="data_clear">æ¸…ç©ºæ•°æ®</button></div></div>
    </div>

    <script>
        // =======================================================
        // === 0. I18N & Translations ===
        // =======================================================
        const Translations = {
            zh: {
                title: 'Timer V34.0 (Ultimate)',
                settings_btn: 'è®¾ç½®', edit_btn: 'ç¼–è¾‘', done_btn: 'å®Œæˆ', soundscape_btn: 'å£°æ™¯', home_btn: 'ä¸»é¡µ',
                soundscape_audio_title: 'Atmosphere Audio (å£°æ™¯)',
                noise_white: 'âšª ç™½å™ªéŸ³ (ä¸“æ³¨)', noise_pink: 'ğŸŒ§ï¸ ç²‰å™ªéŸ³ (é›¨å£°)', noise_brown: 'ğŸŒŠ çº¢å™ªéŸ³ (æ·±æµ·)', noise_off: 'ğŸ”‡ å…³é—­æ‰€æœ‰',
                version_title: 'V34.0 Ultimate', version_features: 'æ–°å¢: äºŒç»´ç  Â· å•ä½æ¢ç®— Â· é—ªå¡',
                hidden_apps_title: 'ğŸ“‚ éšè—åº”ç”¨æ”¶çº³ç›’', reset_layout: 'â†º æ¢å¤é»˜è®¤å¸ƒå±€',
                
                // App Names
                app_exam_name: 'è€ƒåœº', app_pomo_name: 'ç•ªèŒ„', app_cards_name: 'é—ªå¡', app_whiteboard_name: 'ç™½æ¿', app_calc_name: 'è®¡ç®—', app_notes_name: 'ä¾¿ç­¾',
                app_converter_name: 'æ¢ç®—', app_qr_name: 'äºŒç»´ç ', app_breathe_name: 'å‘¼å¸', app_schedule_name: 'æ—¥ç¨‹', app_countdown_name: 'å€’è®¡æ—¶',
                app_stopwatch_name: 'ç§’è¡¨', app_media_name: 'åª’ä½“', app_todo_name: 'å¾…åŠ', app_favs_name: 'æ”¶è—', app_stats_name: 'ç»Ÿè®¡',
                app_long_name: 'ç›®æ ‡', app_account_name: 'æ•°æ®',

                // Sidebar
                settings_title: 'è®¾ç½®', icon_style: 'å›¾æ ‡é£æ ¼', layout_mode: 'å¸ƒå±€æ¨¡å¼', mode_standard: 'æ ‡å‡†', mode_icon: 'å›¾æ ‡', mode_text: 'æ–‡å­—',
                icon_size: 'å›¾æ ‡å¤§å°', card_radius: 'å¡ç‰‡åœ†è§’', theme_style: 'ä¸»é¢˜é£æ ¼', atmosphere_wallpaper: 'æ°›å›´ & å£çº¸', particle_effect: 'ç²’å­ç‰¹æ•ˆ',
                p_float: 'ğŸˆ æ¼‚æµ® (æ°”æ³¡)', p_rain: 'ğŸŒ§ï¸ æš´é›¨ (å€¾æ–œ)', p_snow: 'â„ï¸ é£˜é›ª (æ‘‡æ‘†)', p_breathe: 'ğŸ§˜ å‘¼å¸ (å…‰æ–‘)', p_firefly: 'âœ¨ è¤ç« (æ¸¸èµ°)', p_crazy: 'âš¡ æé€Ÿ (æ”¾å°„)',
                show_particles: 'æ˜¾ç¤ºç²’å­', particle_count: 'ç²’å­æ•°é‡', wallpaper_url: 'å£çº¸ URL...', clear: 'æ¸…ç©º', bg_mask: 'èƒŒæ™¯é®ç½©',
                color_font: 'é…è‰² & å­—ä½“', reset_settings: 'é‡ç½®',

                // Generic
                start: 'å¼€å§‹', stop: 'åœæ­¢', reset: 'é‡ç½®', fullscreen: 'å…¨å±', pause: 'æš‚åœ', clear_to_zero: 'æ¸…é›¶',

                // Pages
                conv_title: 'ğŸ“ å•ä½æ¢ç®—', conv_len: 'é•¿åº¦ (Length)', conv_weight: 'é‡é‡ (Weight)', conv_temp: 'æ¸©åº¦ (Temp)', conv_equals: '=', conv_to: 'to',
                qr_title: 'ğŸ“± äºŒç»´ç ç”Ÿæˆ', qr_input_placeholder: 'è¾“å…¥é“¾æ¥æˆ–æ–‡å­—...', qr_generate: 'ç”Ÿæˆ',
                cards_title: 'ğŸƒ è®°å¿†é—ªå¡', card_tap_start: 'ç‚¹å‡»å¼€å§‹', card_answer_back: 'ç­”æ¡ˆèƒŒé¢', card_prev: 'ä¸Šä¸€å¼ ', card_next: 'ä¸‹ä¸€å¼ ',
                card_q_placeholder: 'é—®é¢˜ (æ­£é¢)', card_a_placeholder: 'ç­”æ¡ˆ (èƒŒé¢)', card_clear: 'æ¸…ç©ºå¡ç‰‡', card_add_success: 'æ·»åŠ æˆåŠŸ',
                calc_title: 'ğŸ§® è®¡ç®—å™¨',
                breathe_title: 'ğŸ§˜ æ·±å‘¼å¸', breathe_inhale: 'å¸æ°”', breathe_hold: 'ä¿æŒ', breathe_exhale: 'å‘¼æ°”', breathe_guide: '4ç§’å¸æ°” - 7ç§’ä¿æŒ - 8ç§’å‘¼æ°”',
                notes_title: 'ğŸ—’ï¸ ä¾¿ç­¾', notes_placeholder: 'åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„æƒ³æ³•... (è‡ªåŠ¨ä¿å­˜)',
                exam_title: 'ğŸ“ è€ƒåœºæ¨¡æ‹Ÿ', exam_subject_placeholder: 'ç§‘ç›®', exam_min: 'åˆ†é’Ÿ', exam_subject_name: 'ç§‘ç›®åç§°',
                exam_status_wait: 'ç­‰å¾…å¼€è€ƒ', exam_status_running: 'è€ƒè¯•è¿›è¡Œä¸­', exam_status_finished: 'è€ƒè¯•å·²ç»“æŸ', exam_end: 'ç»“æŸ', exam_alert: 'è€ƒè¯•ç»“æŸ',
                pomo_title: 'ğŸ… ç•ªèŒ„ä¸“æ³¨', pomo_alert: 'ä¸“æ³¨å®Œæˆ',
                wb_title: 'ğŸ¨ ç™½æ¿', wb_eraser: 'æ©¡çš®æ“¦', media_title: 'ğŸ“º åª’ä½“', media_placeholder: 'ğŸ“‚ é€‰æ‹©è§†é¢‘/éŸ³é¢‘æ–‡ä»¶',
                schedule_title: 'ğŸ“… æ—¥ç¨‹', schedule_add: '+ æ·»åŠ ', schedule_prompt: 'è¯·è¾“å…¥æ—¥ç¨‹å†…å®¹',
                countdown_title: 'â±ï¸ å€’è®¡æ—¶', countdown_alert: 'æ—¶é—´åˆ°', stopwatch_title: 'â²ï¸ ç§’è¡¨',
                todo_title: 'âœ… å¾…åŠ', todo_input_placeholder: 'åœ¨æ­¤è¾“å…¥å¾…åŠ...', todo_add: 'æ·»åŠ ',
                favs_title: 'â­ æ”¶è—', fav_name_placeholder: 'å', fav_save: 'å­˜',
                stats_title: 'ğŸ“Š ç»Ÿè®¡', stat_total: 'æ€»æ¬¡æ•°', stat_today: 'ä»Šæ—¥(åˆ†)',
                long_title: 'ğŸ¯ ç›®æ ‡', long_target_custom: 'è‡ªå®šä¹‰ç›®æ ‡', long_achieved: 'å·²è¾¾æˆ', long_days: 'å¤©', long_hours: 'æ—¶',
                data_title: 'ğŸ’¾ æ•°æ®', data_export: 'å¯¼å‡ºJSON', data_import: 'å¯¼å…¥JSON', data_clear: 'æ¸…ç©ºæ•°æ®', data_clear_confirm: 'ç¡®å®šæ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼Ÿ'
            },
            en: {
                title: 'Timer V34.0 (Ultimate)',
                settings_btn: 'Settings', edit_btn: 'Edit', done_btn: 'Done', soundscape_btn: 'Soundscape', home_btn: 'Home',
                soundscape_audio_title: 'Atmosphere Audio (Soundscape)',
                noise_white: 'âšª White Noise (Focus)', noise_pink: 'ğŸŒ§ï¸ Pink Noise (Rain)', noise_brown: 'ğŸŒŠ Brown Noise (Deep Sea)', noise_off: 'ğŸ”‡ Turn Off All',
                version_title: 'V34.0 Ultimate', version_features: 'New: QR Code Â· Unit Converter Â· Flashcards',
                hidden_apps_title: 'ğŸ“‚ Hidden Apps Drawer', reset_layout: 'â†º Reset Layout',

                // App Names
                app_exam_name: 'Exam', app_pomo_name: 'Pomo', app_cards_name: 'Flashcards', app_whiteboard_name: 'Whiteboard', app_calc_name: 'Calc', app_notes_name: 'Notes',
                app_converter_name: 'Convert', app_qr_name: 'QR Code', app_breathe_name: 'Breathe', app_schedule_name: 'Schedule', app_countdown_name: 'Countdown',
                app_stopwatch_name: 'Stopwatch', app_media_name: 'Media', app_todo_name: 'Todo', app_favs_name: 'Favs', app_stats_name: 'Stats',
                app_long_name: 'Target', app_account_name: 'Data',

                // Sidebar
                settings_title: 'Settings', icon_style: 'Icon Style', layout_mode: 'Layout Mode', mode_standard: 'Standard', mode_icon: 'Icon', mode_text: 'Text',
                icon_size: 'Icon Size', card_radius: 'Card Radius', theme_style: 'Theme Style', atmosphere_wallpaper: 'Atmosphere & Wallpaper', particle_effect: 'Particle Effect',
                p_float: 'ğŸˆ Float (Bubbles)', p_rain: 'ğŸŒ§ï¸ Rain (Slanted)', p_snow: 'â„ï¸ Snow (Wobble)', p_breathe: 'ğŸ§˜ Breathe (Glow)', p_firefly: 'âœ¨ Firefly (Wander)', p_crazy: 'âš¡ Crazy (Radiate)',
                show_particles: 'Show Particles', particle_count: 'Particle Count', wallpaper_url: 'Wallpaper URL...', clear: 'Clear', bg_mask: 'Background Mask',
                color_font: 'Color & Font', reset_settings: 'Reset',

                // Generic
                start: 'Start', stop: 'Stop', reset: 'Reset', fullscreen: 'Fullscreen', pause: 'Pause', clear_to_zero: 'Clear',

                // Pages
                conv_title: 'ğŸ“ Unit Converter', conv_len: 'Length (Length)', conv_weight: 'Weight (Weight)', conv_temp: 'Temperature (Temp)', conv_equals: '=', conv_to: 'to',
                qr_title: 'ğŸ“± QR Code Generator', qr_input_placeholder: 'Enter URL or Text...', qr_generate: 'Generate',
                cards_title: 'ğŸƒ Flashcards', card_tap_start: 'Tap to Start', card_answer_back: 'Answer Back', card_prev: 'Prev', card_next: 'Next',
                card_q_placeholder: 'Question (Front)', card_a_placeholder: 'Answer (Back)', card_clear: 'Clear Cards', card_add_success: 'Card Added',
                calc_title: 'ğŸ§® Calculator',
                breathe_title: 'ğŸ§˜ Deep Breathe', breathe_inhale: 'Inhale', breathe_hold: 'Hold', breathe_exhale: 'Exhale', breathe_guide: '4s Inhale - 7s Hold - 8s Exhale',
                notes_title: 'ğŸ—’ï¸ Notes', notes_placeholder: 'Write your thoughts here... (Auto-save)',
                exam_title: 'ğŸ“ Exam Simulation', exam_subject_placeholder: 'Subject', exam_min: 'min', exam_subject_name: 'Subject Name',
                exam_status_wait: 'Waiting to Start', exam_status_running: 'Exam in Progress', exam_status_finished: 'Exam Finished', exam_end: 'End', exam_alert: 'Exam Finished',
                pomo_title: 'ğŸ… Pomodoro Focus', pomo_alert: 'Focus Complete',
                wb_title: 'ğŸ¨ Whiteboard', wb_eraser: 'Eraser', media_title: 'ğŸ“º Media', media_placeholder: 'ğŸ“‚ Select Video/Audio File',
                schedule_title: 'ğŸ“… Schedule', schedule_add: '+ Add', schedule_prompt: 'Enter schedule item',
                countdown_title: 'â±ï¸ Countdown', countdown_alert: 'Time\'s Up', stopwatch_title: 'â²ï¸ Stopwatch',
                todo_title: 'âœ… Todo List', todo_input_placeholder: 'Enter todo item...', todo_add: 'Add',
                favs_title: 'â­ Favorites', fav_name_placeholder: 'Name', fav_save: 'Save',
                stats_title: 'ğŸ“Š Statistics', stat_total: 'Total Times', stat_today: 'Today (min)',
                long_title: 'ğŸ¯ Target', long_target_custom: 'Custom Target', long_achieved: 'Achieved', long_days: 'Days', long_hours: 'Hrs',
                data_title: 'ğŸ’¾ Data', data_export: 'Export JSON', data_import: 'Import JSON', data_clear: 'Clear Data', data_clear_confirm: 'Are you sure you want to clear all data?'
            }
        };

        const IconSets = {
            // ... (Your existing IconSets remain unchanged) ...
            emoji: { exam:'ğŸ“', pomo:'ğŸ…', whiteboard:'ğŸ¨', media:'ğŸ“º', schedule:'ğŸ“…', countdown:'â±ï¸', stopwatch:'â²ï¸', todo:'âœ…', favs:'â­', stats:'ğŸ“Š', long:'ğŸ¯', account:'ğŸ’¾', calc:'ğŸ§®', breathe:'ğŸ§˜', notes:'ğŸ—’ï¸', converter:'ğŸ“', qr:'ğŸ“±', cards:'ğŸƒ' },
            paths: {
                exam: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z M14 2v6h6 M16 13H8 M16 17H8 M10 9H8',
                pomo: 'M12 22c5.5 0 10-4.5 10-10S17.5 2 12 2 2 6.5 2 12s4.5 10 10 10z M12 6v6l4 2',
                whiteboard: 'M12 19l7-7 3 3-7 7-3-3z M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z',
                media: 'M2 2h20v20H2z M7 2v20 M17 2v20 M2 12h20 M2 7h5 M2 17h5 M17 17h5 M17 7h5',
                schedule: 'M3 4h18v18H3z M16 2v4 M8 2v4 M3 10h18',
                countdown: 'M10 2h4 M12 14v-4 M4 13a8 8 0 0 1 8-7 8 8 0 1 1-5.3 14L4 17.6 M9 17H4v5',
                stopwatch: 'M12 22c5.5 0 10-4.5 10-10S17.5 2 12 2 2 6.5 2 12s4.5 10 10 10z M12 6v6 M12 2v2',
                todo: 'M22 11.08V12a10 10 0 1 1-5.93-9.14 M22 4L12 14.01l-3-3',
                favs: 'M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-5.82 3.25L7 14.14 2 9.27l6.91-1.01L12 2z',
                stats: 'M18 20V10 M12 20V4 M6 20v-6',
                long: 'M12 22c5.5 0 10-4.5 10-10S17.5 2 12 2 2 6.5 2 12s4.5 10 10 10z M12 18c3.3 0 6-2.7 6-6s-2.7-6-6-6-6 2.7-6 6 2.7 6 6 6z M12 14c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z',
                account: 'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z M17 21v-8H7v8',
                calc: 'M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-6 14h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z',
                breathe: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6z',
                notes: 'M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z',
                converter: 'M2 6h20v4H2V6zm2 10h16v-2H4v2zm2 4h12v-2H6v2z',
                qr: 'M3 3h6v6H3V3zm2 2v2h2V5H5zm8-2h6v6h-6V3zm2 2v2h2V5h-2zM3 13h6v6H3v-6zm2 2v2h2v-2H5zm8 4h2v2h-2v-2zm-2-2h2v2h-2v-2zm4 0h2v2h-2v-2zm-2 2h2v2h-2v-2zm0-4h2v2h-2v-2z',
                cards: 'M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z'
            }
        };

        const AppState = {
            pages: [
                // Note: name uses the i18n lookup
                {id:'exam',name:'app_exam_name',key:'exam'}, {id:'pomo',name:'app_pomo_name',key:'pomo'}, {id:'cards',name:'app_cards_name',key:'cards'}, 
                {id:'whiteboard',name:'app_whiteboard_name',key:'whiteboard'}, {id:'calc',name:'app_calc_name',key:'calc'}, {id:'notes',name:'app_notes_name',key:'notes'},
                {id:'converter',name:'app_converter_name',key:'converter'}, {id:'qr',name:'app_qr_name',key:'qr'}, {id:'breathe',name:'app_breathe_name',key:'breathe'},
                {id:'schedule',name:'app_schedule_name',key:'schedule'}, {id:'countdown',name:'app_countdown_name',key:'countdown'}, {id:'stopwatch',name:'app_stopwatch_name',key:'stopwatch'}, 
                {id:'media',name:'app_media_name',key:'media'}, {id:'todo',name:'app_todo_name',key:'todo'}, {id:'favs',name:'app_favs_name',key:'favs'}, 
                {id:'stats',name:'app_stats_name',key:'stats'}, {id:'long',name:'app_long_name',key:'long'}, {id:'account',name:'app_account_name',key:'account'}
            ],
            order: JSON.parse(localStorage.getItem('appOrder')) || null,
            hidden: JSON.parse(localStorage.getItem('hiddenApps')) || []
        };

        // ... (The rest of your existing View, Utils, BgEngine, SoundEngine remains unchanged) ...
        const Utils = { pad: n => n.toString().padStart(2,'0'), format: (s,h) => { const H=Math.floor(s/3600),M=Math.floor((s%3600)/60),S=s%60; return (H>0||h)?`${Utils.pad(H)}:${Utils.pad(M)}:${Utils.pad(S)}`:`${Utils.pad(M)}:${Utils.pad(S)}`; }, fullScreen: on => { const elem = document.documentElement; if(on){ if(elem.requestFullscreen) elem.requestFullscreen(); else if(elem.webkitRequestFullscreen) elem.webkitRequestFullscreen(); } else { if(document.exitFullscreen) document.exitFullscreen().catch(()=>{}); else if(document.webkitExitFullscreen) document.webkitExitFullscreen(); } } };
        const View = {
            setTheme: (t) => { document.documentElement.setAttribute('data-theme', t); localStorage.setItem('theme', t); document.querySelectorAll('.theme-thumb').forEach(el => el.classList.toggle('active', el.dataset.theme === t)); if(document.getElementById('particle-check').checked) BgEngine.toggleParticles(true); if(localStorage.getItem('customRadius')) document.documentElement.style.setProperty('--radius', localStorage.getItem('customRadius')+'px'); else { const d = getComputedStyle(document.documentElement).getPropertyValue('--radius-def').trim(); document.documentElement.style.setProperty('--radius', d); document.getElementById('radius-val').innerText = d; } },
            toggleSidebar: () => { document.getElementById('theme-sidebar').classList.toggle('open'); document.getElementById('sidebar-overlay').classList.toggle('open'); },
            toggleZen: () => { document.body.classList.toggle('zen-mode'); Utils.fullScreen(document.body.classList.contains('zen-mode')); },
            updateGridSize: (v) => { document.documentElement.style.setProperty('--grid-size', v+'px'); localStorage.setItem('customGrid', v); },
            updateIconSize: (v) => { document.documentElement.style.setProperty('--icon-size', v+'rem'); document.getElementById('icon-size-val').innerText=v+'x'; localStorage.setItem('customIconSize', v); },
            updateRadius: (v) => { document.documentElement.style.setProperty('--radius', v+'px'); document.getElementById('radius-val').innerText=v+'px'; localStorage.setItem('customRadius', v); },
            updateRing: (pct, id) => { const el = document.querySelector(`#${id} circle`); if(el) { const r = el.getAttribute('r'); const c = 2 * Math.PI * r; el.style.strokeDasharray = `${c} ${c}`; el.style.strokeDashoffset = (1-pct) * c; } }
        };

        // =======================================================
        // === App Core Logic (Modified for I18N) ===
        // =======================================================
        const App = {
            dragSrc: null, isEditing: false, lang: localStorage.getItem('language') || 'zh',
            i18n: (key) => { return Translations[App.lang][key] || Translations['zh'][key] || key; },
            translateUI: () => {
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (key.startsWith('[placeholder]')) {
                        el.setAttribute('placeholder', App.i18n(key.substring(13)));
                    } else if (key.startsWith('[title]')) {
                        el.setAttribute('title', App.i18n(key.substring(7)));
                    } else {
                        el.innerHTML = App.i18n(key);
                    }
                });
                document.getElementById('lang-switch-btn').innerText = `Language: ${App.lang === 'zh' ? 'EN' : 'ZH'}`;
                document.title = App.i18n('title');
                
                // Update App Names in AppState for the current session (though renderGrid will handle it)
                AppState.pages.forEach(p => { p.name_localized = App.i18n(p.name); });
                App.renderGrid();
            },
            setLanguage: (lang) => {
                App.lang = lang;
                localStorage.setItem('language', lang);
                App.translateUI();
                // Re-render components that rely on language (like converter options)
                Modules.Converter.init();
            },
            toggleLanguage: () => {
                const newLang = App.lang === 'zh' ? 'en' : 'zh';
                App.setLanguage(newLang);
            },
            init: () => {
                App.setLanguage(App.lang); // Initial UI translation
                
                const t = localStorage.getItem('theme') || 'glass_pro'; View.setTheme(t); BgEngine.init();
                const cText = localStorage.getItem('customText'); if(cText) document.documentElement.style.setProperty('--custom-text', cText);
                const cAccent = localStorage.getItem('customAccent'); if(cAccent) document.documentElement.style.setProperty('--custom-accent', cAccent);
                const cGrid = localStorage.getItem('customGrid'); if(cGrid) View.updateGridSize(cGrid);
                const cIcon = localStorage.getItem('customIconSize'); if(cIcon) View.updateIconSize(cIcon);
                
                const themeList = document.getElementById('theme-list');
                ThemeLibrary.themes.forEach(theme => {
                    const d = document.createElement('div'); d.className = 'theme-thumb'; d.dataset.theme = theme.id; d.style.background = theme.bg;
                    let extraHtml = theme.recommended ? `<div class="recommend-badge">${App.i18n('recommend')}</div>` : '';
                    d.innerHTML = `${extraHtml}<div class="mini-ui-card" style="background:${theme.card}; border:${theme.border}; color:${theme.text}; border-radius:${theme.radius}; box-shadow:${theme.shadow}; font-family:${theme.font||'sans-serif'};">Aa</div><div class="theme-name-label" style="width:100%; text-align:center; font-size:0.8rem; color:${['glass_pro','cyberpunk','win10','retro95','darkglass'].includes(theme.id)?'#fff':'#333'};">${theme.name}</div>`;
                    d.onclick = () => View.setTheme(theme.id); if(t === theme.id) d.classList.add('active'); themeList.appendChild(d);
                });

                App.renderGrid();
                setInterval(()=>document.getElementById('clock-real').innerText=new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}),1000);
                Modules.Todo.render(); Modules.Schedule.render(); Modules.Favs.render(); Modules.Long.init(); Modules.Notes.init(); Modules.Cards.init(); Modules.Converter.init();
                
                document.addEventListener('keydown', (e) => { if(['INPUT','TEXTAREA'].includes(e.target.tagName)) return; if(e.code === 'Space') { e.preventDefault(); if(Modules.activeEngine) Modules.activeEngine.stop(); } if(e.key === 'h' || e.key === 'H') App.goHome(); });
                
                const grid = document.getElementById('app-grid');
                let touchTimeout; let draggedItem = null;
                grid.addEventListener('touchstart', (e) => { if(App.isEditing) return; const item = e.target.closest('.app-card'); if (!item) return; touchTimeout = setTimeout(() => { draggedItem = item; item.classList.add('dragging-touch'); if (navigator.vibrate) navigator.vibrate(50); }, 500); });
                grid.addEventListener('touchmove', (e) => { if (!draggedItem) { clearTimeout(touchTimeout); return; } e.preventDefault(); const touch = e.touches[0]; const target = document.elementFromPoint(touch.clientX, touch.clientY); if(!target) return; const targetCard = target.closest('.app-card'); if (targetCard && targetCard !== draggedItem) { const srcId = draggedItem.getAttribute('data-id'); const targetId = targetCard.getAttribute('data-id'); const oldIdx = AppState.order.indexOf(srcId); const newIdx = AppState.order.indexOf(targetId); AppState.order.splice(oldIdx, 1); AppState.order.splice(newIdx, 0, srcId); localStorage.setItem('appOrder', JSON.stringify(AppState.order)); App.renderGrid(); draggedItem = document.querySelector(`.app-card[data-id="${srcId}"]`); if(draggedItem) draggedItem.classList.add('dragging-touch'); } });
                grid.addEventListener('touchend', () => { clearTimeout(touchTimeout); if (draggedItem) { draggedItem.classList.remove('dragging-touch'); draggedItem = null; } });
            },
            toggleEdit: (btn) => { App.isEditing = !App.isEditing; btn.innerHTML = `ğŸ“ <span data-i18n="${App.isEditing ? 'done_btn' : 'edit_btn'}">${App.i18n(App.isEditing ? 'done_btn' : 'edit_btn')}</span>`; btn.classList.toggle('active-edit', App.isEditing); document.body.classList.toggle('editing-mode', App.isEditing); App.renderGrid(); const hiddenArea = document.getElementById('hidden-apps-area'); if(App.isEditing && AppState.hidden.length > 0) hiddenArea.classList.add('show'); else if(!App.isEditing) hiddenArea.classList.remove('show'); },
            toggleVisibility: (id) => { const idx = AppState.hidden.indexOf(id); if(idx > -1) AppState.hidden.splice(idx, 1); else AppState.hidden.push(id); localStorage.setItem('hiddenApps', JSON.stringify(AppState.hidden)); App.renderGrid(); if(AppState.hidden.length === 0 && !App.isEditing) document.getElementById('hidden-apps-area').classList.remove('show'); },
            resetLayout: () => { if(confirm(App.i18n('reset_layout_confirm')||'ç¡®å®šé‡ç½®å¸ƒå±€ï¼Ÿ')) { AppState.order = AppState.pages.map(p => p.id); AppState.hidden = []; localStorage.removeItem('appOrder'); localStorage.removeItem('hiddenApps'); App.renderGrid(); document.getElementById('hidden-apps-area').classList.remove('show'); } },
            setMode: (mode, btn) => { document.getElementById('app-grid').setAttribute('data-mode', mode); document.getElementById('hidden-app-grid').setAttribute('data-mode', mode); localStorage.setItem('displayMode', mode); if(btn) { document.querySelectorAll('.display-mode-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); } },
            setIconType: (type, btn) => { document.getElementById('app-grid').setAttribute('data-icon', type); document.getElementById('hidden-app-grid').setAttribute('data-icon', type); localStorage.setItem('iconType', type); if(btn) { document.querySelectorAll('.icon-type-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); } App.renderGrid(); },
            renderGrid: () => {
                const grid = document.getElementById('app-grid'); grid.innerHTML = ''; const hiddenGrid = document.getElementById('hidden-app-grid'); hiddenGrid.innerHTML = '';
                const type = localStorage.getItem('iconType') || 'emoji';
                if(!AppState.order) AppState.order = AppState.pages.map(p => p.id);
                AppState.pages.forEach(p => { if(!AppState.order.includes(p.id)) AppState.order.push(p.id); }); // Ensure new apps appear
                AppState.order.forEach((id) => { const page = AppState.pages.find(p => p.id === id); if(!page || AppState.hidden.includes(id)) return; grid.appendChild(App.createCard(page, type, false)); });
                if(App.isEditing || AppState.hidden.length > 0) AppState.hidden.forEach(id => { const page = AppState.pages.find(p => p.id === id); if(page) { const c = App.createCard(page, type, true); c.style.opacity = "0.7"; hiddenGrid.appendChild(c); } });
                const hiddenArea = document.getElementById('hidden-apps-area'); if(App.isEditing) hiddenArea.classList.add('show'); else hiddenArea.classList.remove('show');
            },
            createCard: (page, type, isHidden) => {
                const d = document.createElement('div'); d.className = 'app-card'; d.setAttribute('data-id', page.id);
                const path = IconSets.paths[page.key];
                let iconHtml = type === 'emoji' ? `<div class="icon-emoji">${IconSets.emoji[page.key]}</div>` : `<svg class="icon-svg ${type === 'duotone' ? 'duotone' : (type === 'solid' ? 'solid' : 'line')}" viewBox="0 0 24 24"><path d="${path}"></path></svg>`;
                d.innerHTML = `<div class="icon-container">${iconHtml}</div><h3>${App.i18n(page.name)}</h3>`; // Use i18n lookup for name
                if(App.isEditing) { d.classList.add('jiggle'); const badge = document.createElement('div'); badge.className = isHidden ? 'edit-badge add' : 'edit-badge'; badge.innerHTML = isHidden ? '+' : 'âˆ’'; badge.onclick = (e) => { e.stopPropagation(); App.toggleVisibility(page.id); }; d.appendChild(badge); d.onclick = null; } 
                else { d.draggable = true; d.onclick = () => App.go(page.id); d.addEventListener('dragstart', App.handleDragStart); d.addEventListener('dragover', e => {e.preventDefault(); return false;}); d.addEventListener('drop', App.handleDrop); d.addEventListener('dragend', () => document.querySelectorAll('.app-card').forEach(c => c.classList.remove('dragging'))); }
                return d;
            },
            handleDragStart: (e) => { App.dragSrc = e.currentTarget; e.dataTransfer.effectAllowed = 'move'; e.currentTarget.classList.add('dragging'); },
            handleDrop: (e) => { e.stopPropagation(); const srcId = App.dragSrc.getAttribute('data-id'); const targetId = e.currentTarget.getAttribute('data-id'); if (srcId !== targetId) { const oldIdx = AppState.order.indexOf(srcId); const newIdx = AppState.order.indexOf(targetId); AppState.order.splice(oldIdx, 1); AppState.order.splice(newIdx, 0, srcId); localStorage.setItem('appOrder', JSON.stringify(AppState.order)); App.renderGrid(); } return false; },
            go: (id) => { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(`page-${id}`).classList.add('active'); document.getElementById('page-home').classList.remove('active'); document.getElementById('btn-home').classList.remove('hidden'); document.getElementById('btn-edit-home').style.display='none'; if(id==='whiteboard') setTimeout(Modules.Whiteboard.init, 100); },
            goHome: () => { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById('page-home').classList.add('active'); document.getElementById('btn-home').classList.add('hidden'); document.getElementById('btn-edit-home').style.display='block'; if(document.body.classList.contains('zen-mode')) View.toggleZen(); Modules.stopAll(); }
        };

        // =======================================================
        // === Modules (Modified for I18N and dynamic content) ===
        // =======================================================
        class Engine { constructor(t,e){this.t=t;this.e=e;this.tm=null} start(s){this.stop();this.rem=s;this.tot=s;this.tm=setInterval(()=>{this.rem--;this.t(this.rem,this.tot);if(this.rem<=0){this.stop();this.e()}},1000)} stop(){clearInterval(this.tm)} }
        const Modules={
            activeEngine:null,
            Exam:{ eng:new Engine((r,t)=>{document.getElementById('exam-timer').innerText=Utils.format(r,r>3600);},()=>{document.getElementById('sfx-bell').play();alert(App.i18n('exam_alert'));View.toggleZen()}), start:()=>{Modules.stopAll();Modules.Exam.eng.start(document.getElementById('ex-dur').value*60);document.getElementById('disp-sub').innerText=document.getElementById('ex-sub').value;document.getElementById('disp-status').innerText=App.i18n('exam_status_running');if(!document.body.classList.contains('zen-mode'))View.toggleZen();document.getElementById('btn-exam-stop').classList.remove('hidden');}, stop:()=>{Modules.Exam.eng.stop();document.getElementById('disp-status').innerText=App.i18n('exam_status_finished');document.getElementById('btn-exam-stop').classList.add('hidden');} },
            Pomo:{ eng:new Engine((r,t)=>{document.getElementById('pomo-timer').innerText=Utils.format(r);View.updateRing(r/t, 'pomo-container');},()=>{document.getElementById('sfx-ding').play();alert(App.i18n('pomo_alert'));}), start:()=>{Modules.stopAll();Modules.Pomo.eng.start(25*60);Modules.activeEngine=Modules.Pomo.eng;}, reset:()=>{Modules.Pomo.eng.stop();document.getElementById('pomo-timer').innerText="25:00";View.updateRing(1, 'pomo-container');} },
            Calc: { append: (val) => { const d = document.getElementById('calc-display'); if(d.value === '0' && val !== '.') d.value = val; else d.value += val; }, cls: () => { document.getElementById('calc-display').value = '0'; }, eq: () => { try { document.getElementById('calc-display').value = eval(document.getElementById('calc-display').value) } catch { document.getElementById('calc-display').value = 'Error' } } },
            Breathe: { 
                tm: null, 
                updateText: (key) => { document.getElementById('breath-text').innerText = App.i18n(key); },
                start: () => { 
                    Modules.stopAll(); 
                    const circle = document.getElementById('breath-circle'); 
                    const cycle = () => { 
                        Modules.Breathe.updateText('breathe_inhale'); circle.style.transform = "scale(1.5)"; 
                        setTimeout(() => { 
                            Modules.Breathe.updateText('breathe_hold'); 
                            setTimeout(() => { 
                                Modules.Breathe.updateText('breathe_exhale'); circle.style.transform = "scale(1)"; 
                            }, 7000); 
                        }, 4000); 
                    }; 
                    cycle(); Modules.Breathe.tm = setInterval(cycle, 19000); 
                }, 
                stop: () => { 
                    clearInterval(Modules.Breathe.tm); 
                    document.getElementById('breath-circle').style.transform = "scale(1)"; 
                    Modules.Breathe.updateText('breathe_inhale'); 
                } 
            },
            Notes: { init: () => { document.getElementById('notes-area').value = localStorage.getItem('quickNotes') || ''; }, save: () => { localStorage.setItem('quickNotes', document.getElementById('notes-area').value); } },
            Whiteboard:{ ctx:null,color:'#000',width:3,drawing:false, init:()=>{ const c=document.getElementById('wb-canvas'); const box = document.querySelector('#page-whiteboard .timer-box'); if(box) { c.width = box.offsetWidth; c.height = box.offsetHeight - 50; } Modules.Whiteboard.ctx=c.getContext('2d'); const start=(e)=>{Modules.Whiteboard.drawing=true;Modules.Whiteboard.draw(e);}; const move=(e)=>{Modules.Whiteboard.draw(e);}; const end=()=>{Modules.Whiteboard.drawing=false;Modules.Whiteboard.ctx.beginPath();}; c.addEventListener('mousedown', start); c.addEventListener('mousemove', move); c.addEventListener('mouseup', end); c.addEventListener('mouseout', end); c.addEventListener('touchstart', (e)=>{e.preventDefault();start(e.touches[0])}, {passive:false}); c.addEventListener('touchmove', (e)=>{e.preventDefault();move(e.touches[0])}, {passive:false}); c.addEventListener('touchend', end); }, draw:e=>{ if(!Modules.Whiteboard.drawing)return; const r=e.target.getBoundingClientRect(); const x=e.clientX-r.left,y=e.clientY-r.top; const x_c=Modules.Whiteboard.ctx; x_c.lineWidth = Modules.Whiteboard.width; x_c.lineCap='round'; x_c.strokeStyle=Modules.Whiteboard.color; x_c.lineTo(x,y); x_c.stroke(); x_c.beginPath(); x_c.moveTo(x,y); }, clear:()=>{const c=document.getElementById('wb-canvas');Modules.Whiteboard.ctx.clearRect(0,0,c.width,c.height)} },
            Media:{ load:i=>{const f=i.files[0];if(f){document.getElementById('video-player').src=URL.createObjectURL(f);document.getElementById('media-container').classList.remove('hidden');document.querySelector('.media-drop-zone').style.display='none'}} },
            Countdown:{ eng:new Engine((r,t)=>{document.getElementById('cd-timer').innerText=Utils.format(r);View.updateRing(r/t, 'cd-container');},()=>{document.getElementById('sfx-ding').play();alert(App.i18n('countdown_alert'));}), start:()=>{Modules.stopAll();Modules.Countdown.eng.start(document.getElementById('cd-input').value*60);Modules.activeEngine=Modules.Countdown.eng;} },
            Stopwatch:{ t:0,tm:null,start:()=>{if(!Modules.Stopwatch.tm)Modules.Stopwatch.tm=setInterval(()=>{Modules.Stopwatch.t+=100;const d=new Date(Modules.Stopwatch.t);document.getElementById('sw-timer').innerText=`${Utils.pad(d.getUTCMinutes())}:${Utils.pad(d.getUTCSeconds())}.${Math.floor(d.getUTCMilliseconds()/10)}`},100)},pause:()=>{clearInterval(Modules.Stopwatch.tm);Modules.Stopwatch.tm=null},reset:()=>{Modules.Stopwatch.pause();Modules.Stopwatch.t=0;document.getElementById('sw-timer').innerText="00:00.00"} },
            Todo:{ r:()=>{document.getElementById('todo-list').innerHTML=Data.store.todos.map((t,i)=>`<div class="list-item"><span onclick="Data.store.todos[${i}].done=!Data.store.todos[${i}].done;Data.save('todos');Modules.Todo.r()" style="flex:1;text-decoration:${t.done?'line-through':'none'};cursor:pointer;">${t.txt}</span><button onclick="Data.store.todos.splice(${i},1);Data.save('todos');Modules.Todo.r()" style="background:transparent;border:none;">âœ•</button></div>`).join('')}, add:()=>{const v=document.getElementById('todo-input').value;if(v){Data.store.todos.push({txt:v,done:false});Data.save('todos');Modules.Todo.r();document.getElementById('todo-input').value=''}}, render: function(){this.r()} },
            Schedule:{ r:()=>{document.getElementById('schedule-list').innerHTML=Data.store.schedule.map((s,i)=>`<div class="list-item"><span>${s}</span><button onclick="Data.store.schedule.splice(${i},1);Data.save('schedule');Modules.Schedule.r()" style="background:transparent;border:none;margin-left:auto;">Ã—</button></div>`).join('')}, add:()=>{const v=prompt(App.i18n('schedule_prompt'));if(v){Data.store.schedule.push(v);Data.save('schedule');Modules.Schedule.r()}}, clear:()=>{Data.store.schedule=[];Data.save('schedule');Modules.Schedule.r()}, render: function(){this.r()} },
            Favs:{ r:()=>{document.getElementById('fav-list').innerHTML=Data.store.favs.map((f,i)=>`<div class="list-item"><a href="${f.url}" target="_blank" style="flex:1;text-decoration:none;color:inherit;">${f.name}</a><button onclick="Data.store.favs.splice(${i},1);Data.save('favs');Modules.Favs.r()" style="background:transparent;border:none;">Ã—</button></div>`).join('')}, add:()=>{const n=document.getElementById('fav-name').value,u=document.getElementById('fav-url').value;if(n&&u){Data.store.favs.push({name:n,url:u});Data.save('favs');Modules.Favs.r()}}, render: function(){this.r()} },
            Long:{ init:()=>{setInterval(()=>{['target'].forEach(k=>{const d=Data.store.long[k];if(!d)return;const df=new Date(d)-new Date();const el=document.getElementById('target-display');if(df<=0)el.innerText=App.i18n('long_achieved');else{const D=Math.floor(df/86400000),H=Math.floor((df%86400000)/3600000);el.innerText=`${D} ${App.i18n('long_days')} ${H} ${App.i18n('long_hours')}`}})},1000)}, set:k=>{Data.store.long[k]=document.getElementById('target-input').value;localStorage.setItem('targetDate',Data.store.long[k])} },
            QR: { gen: () => { const txt=document.getElementById('qr-input').value; if(txt){ document.getElementById('qr-image').src=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(txt)}`; document.getElementById('qr-image').style.display='block'; } } },
            Converter: { 
                units: { len: ['m','km','ft','mi','cm'], weight: ['kg','lb','oz','g'], temp: ['C','F','K'] },
                init: () => { Modules.Converter.render(); },
                render: () => { 
                    const t = document.getElementById('conv-type').value; 
                    const u = Modules.Converter.units[t]; 
                    const s1 = document.getElementById('conv-u1'); 
                    const s2 = document.getElementById('conv-u2'); 
                    s1.innerHTML=''; s2.innerHTML=''; 
                    // Update options list based on type selection (and language for select box)
                    document.querySelectorAll('#conv-type option').forEach(opt => {
                        opt.innerHTML = App.i18n(opt.getAttribute('data-i18n'));
                    });
                    u.forEach(x => { s1.add(new Option(x,x)); s2.add(new Option(x,x)); }); s2.selectedIndex=1; 
                    Modules.Converter.calc(); 
                },
                calc: () => { 
                    const t = document.getElementById('conv-type').value; const v = parseFloat(document.getElementById('conv-in').value); const u1 = document.getElementById('conv-u1').value; const u2 = document.getElementById('conv-u2').value;
                    let res = v;
                    if(t === 'temp') {
                        if(u1==='C'&&u2==='F') res=v*9/5+32; else if(u1==='C'&&u2==='K') res=v+273.15;
                        else if(u1==='F'&&u2==='C') res=(v-32)*5/9; else if(u1==='F'&&u2==='K') res=(v-32)*5/9+273.15;
                        else if(u1==='K'&&u2==='C') res=v-273.15; else if(u1==='K'&&u2==='F') res=(v-273.15)*9/5+32;
                    } else {
                        // Simple linear calc via base
                        const rates = { m:1, km:1000, cm:0.01, ft:0.3048, mi:1609.34, kg:1, g:0.001, lb:0.453592, oz:0.0283495 };
                        const base = v * rates[u1]; res = base / rates[u2];
                    }
                    document.getElementById('conv-out').innerText = isNaN(res)?'--':res.toFixed(4).replace(/\.?0+$/,'');
                }
            },
            Cards: {
                list: JSON.parse(localStorage.getItem('cards') || '[]'), idx: 0,
                init: () => { Modules.Cards.show(); },
                add: () => { const q=document.getElementById('card-q').value; const a=document.getElementById('card-a').value; if(q&&a){Modules.Cards.list.push({q,a}); localStorage.setItem('cards', JSON.stringify(Modules.Cards.list)); document.getElementById('card-q').value='';document.getElementById('card-a').value=''; Modules.Cards.idx = Modules.Cards.list.length-1; Modules.Cards.show(); alert(App.i18n('card_add_success'));} },
                show: () => { 
                    const c = Modules.Cards.list[Modules.Cards.idx]; 
                    document.getElementById('card-front').innerText = c ? c.q : App.i18n('card_tap_start'); 
                    document.getElementById('card-back').innerText = c ? c.a : App.i18n('card_answer_back'); 
                    document.getElementById('card-count').innerText = `${Modules.Cards.list.length > 0 ? Modules.Cards.idx + 1 : 0}/${Modules.Cards.list.length}`;
                    document.querySelector('.flashcard').classList.remove('flipped');
                },
                next: () => { if(Modules.Cards.idx < Modules.Cards.list.length - 1) { Modules.Cards.idx++; Modules.Cards.show(); } },
                prev: () => { if(Modules.Cards.idx > 0) { Modules.Cards.idx--; Modules.Cards.show(); } },
                clear: () => { if(confirm(App.i18n('card_clear_confirm')||'æ¸…ç©ºæ‰€æœ‰å¡ç‰‡ï¼Ÿ')) { Modules.Cards.list=[]; localStorage.setItem('cards','[]'); Modules.Cards.idx=0; Modules.Cards.show(); } }
            },
            stopAll:()=>{if(Modules.activeEngine)Modules.activeEngine.stop();Modules.Stopwatch.pause();Modules.Breathe.stop();}
        };

        // ... (The rest of your existing Data object remains unchanged) ...
        const Data = {
            store: { todos: JSON.parse(localStorage.getItem('todos')||'[]'), schedule: JSON.parse(localStorage.getItem('schedule')||'[]'), favs: JSON.parse(localStorage.getItem('favs')||'[]'), stats: JSON.parse(localStorage.getItem('stats')||'{"total":0,"today":0}'), long: { target: localStorage.getItem('targetDate') } },
            save: (k) => localStorage.setItem(k, JSON.stringify(Data.store[k])),
            export: () => { const b = new Blob([JSON.stringify(localStorage)], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'timer_v34_backup.json'; a.click(); },
            import: (inp) => { const r = new FileReader(); r.onload = e => { try { const d = JSON.parse(e.target.result); Object.assign(localStorage, d); alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼Œå³å°†åˆ·æ–°'); location.reload(); } catch(err) { alert('æ–‡ä»¶æ ¼å¼é”™è¯¯'); } }; if(inp.files.length) r.readAsText(inp.files[0]); }
        };

        window.onload = App.init;
    </script>
</body>
</html>