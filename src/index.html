<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šé£æ ¼è®¡æ—¶å™¨ V7.4 (é˜²ä¼ªç‰ˆ)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Roboto+Mono:wght=700&family=Noto+Sans+JP:wght=400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ======================================================= */
        /* === 1. æ ¸å¿ƒå˜é‡å®šä¹‰ (ä¿æŒåŸæœ‰ä¸å˜) === */
        /* ======================================================= */

        /* --- é»˜è®¤/Fallback é£æ ¼: BAHAUS (å·¥ä¸šè®¾è®¡é£) --- */
        :root {
            /* é¢œè‰² */
            --bg-color: #ededed;
            --paper-color: #ffffff;
            --text-color: #1a1a1a;
            --main-color: #0077b6; /* å·¥ä¸šè“ */
            --secondary-color: #ffc300; /* å‡ ä½•é»„ */
            --accent-color: #d62828; /* è­¦ç¤ºçº¢ */
            --pomodoro-break-color: #00b4d8; 
            --pomodoro-long-break-color: #4CAF50; /* ç»¿è‰²é•¿ä¼‘ */
            /* å‡ ä½• */
            --border-radius: 0px; 
            --border-thick: 2px;
            --shadow-primary: 4px 4px 0px var(--text-color); 
            --shadow-secondary: none;
            /* å­—ä½“ */
            --font-family: 'Inter', sans-serif;
            --mono-font-family: 'Roboto Mono', monospace;
            --time-font-size: 8em; /* é»˜è®¤å¤§å° */
            --time-font-color: var(--main-color);
            --time-text-shadow: none;
        }

        /* --- é£æ ¼å®šä¹‰: Apple (æç®€é£) --- */
        html.style-apple {
            --bg-color: #f2f2f7;
            --paper-color: #ffffff;
            --text-color: #1c1c1e;
            --main-color: #007aff; /* ç³»ç»Ÿè“ */
            --secondary-color: #ff9500; /* è­¦å‘Šæ©™ */
            --accent-color: #ff3b30; /* é€šçŸ¥çº¢ */
            --pomodoro-break-color: #34c759; /* ä¼‘æ†©ç»¿ */
            --pomodoro-long-break-color: #007aff; /* ä¼‘æ¯é¢œè‰²ä½¿ç”¨ç³»ç»Ÿè“ */
            --border-radius: 12px;
            --border-thick: 0px;
            --shadow-primary: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            --shadow-secondary: none;
            --time-font-size: 7em;
            --time-font-color: var(--text-color);
        }

        /* --- é£æ ¼å®šä¹‰: Neumorphism (æ‹Ÿç‰©é£) --- */
        html.style-neo {
            --bg-color: #e0e5ec;
            --paper-color: #e0e5ec;
            --text-color: #333333;
            --main-color: #4CAF50; /* æˆåŠŸç»¿ */
            --secondary-color: #ffc107; /* æé†’é»„ */
            --accent-color: #f44336; /* é”™è¯¯çº¢ */
            --pomodoro-break-color: #2196F3; /* ä¿¡æ¯è“ */
            --pomodoro-long-break-color: #FF9800; /* æ©™è‰²é•¿ä¼‘ */
            --border-radius: 20px;
            --border-thick: 0px;
            --shadow-primary: 6px 6px 12px #b8b8b8;
            --shadow-secondary: -6px -6px 12px #ffffff;
            --time-font-size: 8em;
            --time-font-color: var(--text-color);
            --time-text-shadow: none;
        }

        /* --- é£æ ¼å®šä¹‰: Cyberpunk (èµ›åšæœ‹å…‹é£) --- */
        html.style-cyberpunk {
            --bg-color: #000000;
            --paper-color: #111111;
            --text-color: #00ffc8; /* éœ“è™¹ç»¿ */
            --main-color: #ff00ff; /* èµ›åšç´« */
            --secondary-color: #ffff00; /* è­¦å‘Šé»„ */
            --accent-color: #ff3300; /* æ•…éšœçº¢ */
            --pomodoro-break-color: #00ffff; /* ç”µå­é’ */
            --pomodoro-long-break-color: #ff99e6; /* ç”µå­ç²‰é•¿ä¼‘ */
            --border-radius: 4px;
            --border-thick: 2px;
            --shadow-primary: 0 0 10px rgba(255, 0, 255, 0.5); /* ä¸»è‰²è¾‰å…‰ */
            --shadow-secondary: 0 0 5px rgba(0, 255, 200, 0.3); /* å‰¯è‰²è¾‰å…‰ */
            --font-family: 'Roboto Mono', monospace; 
            --time-font-size: 9em;
            --time-font-color: var(--main-color);
            --time-text-shadow: 0 0 10px var(--main-color), 0 0 20px var(--main-color); /* æ•°å­—è¾‰å…‰ */
        }
        
        /* --- é£æ ¼å®šä¹‰: Sketch (æ‰‹ç»˜é£) --- */
        html.style-sketch {
            --bg-color: #fdf6e3; /* ç±³é»„è‰²åº• */
            --paper-color: #ffffff; /* ç™½çº¸ */
            --text-color: #333333;
            --main-color: #268bd2; /* è“ç¬” */
            --secondary-color: #cb4b16; /* æ©™è‰²æ ‡è®° */
            --accent-color: #dc322f; /* çº¢ç¬” */
            --pomodoro-break-color: #859900; /* ç»¿è‰²æ ‡è®° */
            --pomodoro-long-break-color: #6c71c4; /* ç´«è‰²é•¿ä¼‘ */
            --border-radius: 8px;
            --border-thick: 2px;
            --shadow-primary: 4px 4px 0px rgba(0, 0, 0, 0.5); /* æ¨¡æ‹Ÿé˜´å½±æ‰‹ç»˜ */
            --shadow-secondary: none;
            --font-family: 'Comic Sans MS', cursive, sans-serif; /* ğŸ˜œ çµé­‚å­—ä½“ */
            --mono-font-family: 'Comic Sans MS', cursive, sans-serif;
            --time-font-size: 8em;
            --time-font-color: var(--accent-color);
            --time-text-shadow: none;
        }

        /* --- é£æ ¼å®šä¹‰: Christmas (åœ£è¯èŠ‚) --- */
        html.style-christmas {
            --bg-color: #a42828; /* æ·±çº¢ */
            --paper-color: #ffffff;
            --text-color: #1a1a1a;
            --main-color: #228b22; /* æ£®æ—ç»¿ */
            --secondary-color: #ffd700; /* é»„é‡‘ */
            --accent-color: #c70000; /* åœ£è¯çº¢ */
            --pomodoro-break-color: #00bfff; /* å†°é›ªè“ */
            --pomodoro-long-break-color: #8b4513; /* å§œé¥¼æ£•é•¿ä¼‘ */
            --border-radius: 15px;
            --border-thick: 3px;
            --shadow-primary: 0 5px 15px rgba(0, 0, 0, 0.3);
            --shadow-secondary: none;
            --font-family: 'Inter', sans-serif;
            --time-font-size: 8em;
            --time-font-color: var(--secondary-color);
            --time-text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* --- é£æ ¼å®šä¹‰: Usagi (ä¹Œè¨å¥‡/å¯çˆ±) --- */
        html.style-usagi {
            --bg-color: #fffaf0; /* å¥¶ç™½è‰² */
            --paper-color: #ffffff;
            --text-color: #4a4a4a;
            --main-color: #ffb6c1; /* æµ…ç²‰ */
            --secondary-color: #f0e68c; /* å¥¶é»„ */
            --accent-color: #dc143c; /* å¡å“‡ä¼Šçº¢ */
            --pomodoro-break-color: #87cefa; /* å¤©ç©ºè“ */
            --pomodoro-long-break-color: #98fb98; /* è–„è·ç»¿é•¿ä¼‘ */
            --border-radius: 30px;
            --border-thick: 1px;
            --shadow-primary: 0 8px 15px -3px rgba(255, 182, 193, 0.5); /* ç²‰è‰²æŸ”å’Œé˜´å½± */
            --shadow-secondary: none;
            --font-family: 'Noto Sans JP', sans-serif; /* å¯çˆ±å­—ä½“ */
            --mono-font-family: 'Noto Sans JP', sans-serif;
            --time-font-size: 7.5em;
            --time-font-color: var(--accent-color);
            --time-text-shadow: 2px 2px 0px var(--main-color);
        }

        /* --- é£æ ¼å®šä¹‰: Doraemon (å“†å•¦Aæ¢¦) --- */
        html.style-doraemon {
            --bg-color: #f0f8ff; /* æµ…è“åº• */
            --paper-color: #ffffff;
            --text-color: #1e3a8a; /* æ·±è“æ–‡å­— */
            --main-color: #3b82f6; /* ä¸»è“ */
            --secondary-color: #facc15; /* é»„é“ƒé“› */
            --accent-color: #ef4444; /* çº¢é¢†å·¾ */
            --pomodoro-break-color: #4ade80; /* ä¼‘æ¯ç»¿ */
            --pomodoro-long-break-color: #f97316; /* æ©™è‰²é•¿ä¼‘ */
            --border-radius: 10px;
            --border-thick: 2px;
            --shadow-primary: 5px 5px 0px var(--text-color); /* ç²—æè¾¹ */
            --shadow-secondary: none;
            --font-family: 'Inter', sans-serif;
            --time-font-size: 8em;
            --time-font-color: var(--accent-color);
            --time-text-shadow: none;
        }

        /* --- é£æ ¼å®šä¹‰: Windows11 (Fluent) --- */
        html.style-win11 {
            --bg-color: #f3f3f3;
            --paper-color: #ffffff;
            --text-color: #202020;
            --main-color: #0067b8; /* Fluent Blue */
            --secondary-color: #ffc439; /* æé†’é»„ */
            --accent-color: #c42b1c; /* é”™è¯¯çº¢ */
            --pomodoro-break-color: #00a4a4; /* é’è‰²ä¼‘æ¯ */
            --pomodoro-long-break-color: #0078d4; /* è“é•¿ä¼‘ */
            --border-radius: 8px;
            --border-thick: 0px;
            --shadow-primary: 0 1.5px 3px rgba(0, 0, 0, 0.1), 0 0 1px rgba(0, 0, 0, 0.05); /* å¾®è½¯æŸ”å’Œé˜´å½± */
            --shadow-secondary: none;
            --font-family: 'Segoe UI', 'Inter', sans-serif;
            --time-font-size: 7em;
            --time-font-color: var(--text-color);
            --time-text-shadow: none;
        }

        /* --- é£æ ¼å®šä¹‰: Glassmorphism (æµåŠ¨ç»ç’ƒ) --- */
        html.style-glass {
            --bg-color: #1a1a1a; 
            --paper-color: rgba(255, 255, 255, 0.2); 
            --text-color: #ffffff;
            --main-color: #90d4ff; 
            --secondary-color: #ffe082; 
            --accent-color: #ff6e6e; 
            --pomodoro-break-color: #a7f3d0; 
            --pomodoro-long-break-color: #93c5fd; 
            --border-radius: 18px;
            --border-thick: 1px;
            --shadow-primary: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --shadow-secondary: none;
            --font-family: 'Inter', sans-serif;
            --time-font-size: 8em;
            --time-font-color: var(--text-color);
            --time-text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);

            background-color: #1a1a1a; 
            background-image: linear-gradient(135deg, #1f283e 0%, #3a002c 100%);
        }
        
        html.style-glass .timer-box, 
        html.style-glass .schedule-editor-box, 
        html.style-glass .home-card {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18); 
        }
        html.style-glass .home-card:hover {
            background-color: rgba(255, 255, 255, 0.3);
            box-shadow: var(--shadow-primary); 
        }
        html.style-glass button, 
        html.style-glass input, 
        html.style-glass select {
            background-color: rgba(255, 255, 255, 0.1); 
            border-color: rgba(255, 255, 255, 0.3);
            color: var(--text-color);
            box-shadow: none;
        }

        /* --- é£æ ¼å®šä¹‰: Win2000 (å¤å¤) --- */
        html.style-win2000 {
            --bg-color: #c0c0c0; 
            --paper-color: #f0f0f0;
            --text-color: #000000;
            --main-color: #000080; 
            --secondary-color: #808080; 
            --accent-color: #ff0000; 
            --pomodoro-break-color: #008000; 
            --pomodoro-long-break-color: #800080; 
            --border-radius: 0px;
            --border-thick: 1px;
            --shadow-primary: none; 
            --shadow-secondary: none;
            --font-family: 'Tahoma', 'Arial', sans-serif;
            --mono-font-family: 'Courier New', monospace;
            --time-font-size: 6.5em; 
            --time-font-color: var(--main-color);
            --time-text-shadow: none;
        }

        html.style-win2000 .timer-box, 
        html.style-win2000 .schedule-editor-box, 
        html.style-win2000 .home-card {
            border: 1px solid #c0c0c0; 
            box-shadow: inset -1px -1px #fff, inset 1px 1px #000, inset -2px -2px #dfdfdf, inset 2px 2px #808080;
        }
        html.style-win2000 button, 
        html.style-win2000 input, 
        html.style-win2000 select {
            border: 1px solid #000;
            box-shadow: inset -1px -1px #fff, inset 1px 1px #808080;
            background-color: #c0c0c0;
            padding: 8px 15px;
            text-transform: none;
        }
        html.style-win2000 button:active {
            box-shadow: inset 1px 1px #fff, inset -1px -1px #808080;
        }

        /* --- é£æ ¼å®šä¹‰: macOS (ç°ä»£) --- */
        html.style-macos {
            --bg-color: #f5f5f7;
            --paper-color: #ffffff;
            --text-color: #1d1d1f;
            --main-color: #007aff; 
            --secondary-color: #ff9f0a; 
            --accent-color: #ff453a; 
            --pomodoro-break-color: #30d158; 
            --pomodoro-long-break-color: #5e5ce6; 
            --border-radius: 10px;
            --border-thick: 0px;
            --shadow-primary: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-secondary: none;
            --font-family: 'SF Pro Text', 'Inter', sans-serif;
            --time-font-size: 7.5em;
            --time-font-color: var(--text-color);
            --time-text-shadow: none;
        }

        /* ======================================================= */
        /* === 2. æ–°å¢ï¼šå¤œé—´æ¨¡å¼å®šä¹‰ === */
        /* ======================================================= */

        html.dark-mode {
            /* æ ¸å¿ƒé¢œè‰²åè½¬ */
            --bg-color: #121212;
            --paper-color: #1e1e1e;
            --text-color: #ffffff;
            /* ä¿æŒä¸»è‰²è°ƒä¸å˜ï¼Œä½†å¯èƒ½éœ€è¦å¾®è°ƒä»¥é€‚åº”æ·±è‰²èƒŒæ™¯ */
            --main-color: #4da6ff; /* äº®è“ */
            --secondary-color: #ffe082; /* äº®é»„ */
            --accent-color: #ff6b6b; /* äº®çº¢ */
            --pomodoro-break-color: #34d084; 
            --pomodoro-long-break-color: #9b59b6; 
            /* é˜´å½±è°ƒæ•´ */
            --shadow-primary: 0 4px 10px rgba(0, 0, 0, 0.5);
            --shadow-secondary: none;
            --time-font-color: var(--main-color);
        }

        /* è¦†ç›– Win2000 çš„ç‰¹æ®Šé˜´å½± */
        html.dark-mode.style-win2000 .timer-box,
        html.dark-mode.style-win2000 .schedule-editor-box,
        html.dark-mode.style-win2000 .home-card {
            box-shadow: inset -1px -1px #444, inset 1px 1px #000, inset -2px -2px #333, inset 2px 2px #555;
            border-color: #444;
            background-color: #2e2e2e;
            color: #ccc;
        }
        html.dark-mode.style-win2000 button, 
        html.dark-mode.style-win2000 input, 
        html.dark-mode.style-win2000 select {
            background-color: #333;
            color: #fff;
            border-color: #555;
            box-shadow: inset -1px -1px #555, inset 1px 1px #111;
        }
        html.dark-mode.style-win2000 button:active {
            box-shadow: inset 1px 1px #555, inset -1px -1px #111;
        }
        
        /* ======================================================= */
        /* === 3. é€šç”¨ä¸å¸ƒå±€ CSS (å·²æ›´æ–°) === */
        /* ======================================================= */
        body {
            font-family: var(--font-family); 
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh; 
            width: 100vw;
            overflow-x: hidden;
            line-height: 1.5;
            transition: background-color 0.4s ease, color 0.4s ease, background-image 0.4s ease;
        }
        /* æ–°å¢ï¼šé—ªçƒåŠ¨ç”» */
        .flash-animation {
            animation: flash-bg 2s ease-in-out;
        }
        @keyframes flash-bg {
            0% { filter: brightness(1); }
            50% { filter: brightness(2.5); }
            100% { filter: brightness(1); }
        }

        .hidden { display: none !important; }
        .page-content { display: none; }
        .page-content.active { display: block; }

        .main-wrapper {
            width: 100%;
            max-width: 1200px;
            padding: 40px 20px;
            margin: 0 auto;
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
            position: relative; 
            padding-bottom: 120px; 
            padding-top: 80px; 
        }

        .timer-box, .schedule-editor-box, .home-card {
            background-color: var(--paper-color);
            padding: 30px;
            border: var(--border-thick) solid var(--text-color); 
            box-shadow: var(--shadow-primary), var(--shadow-secondary); 
            margin-bottom: 30px;
            border-radius: var(--border-radius); 
            transition: all 0.3s ease;
        }
        
        .time-display {
            font-family: var(--mono-font-family);
            font-size: var(--time-font-size); 
            color: var(--time-font-color);
            text-align: center;
            margin: 40px 0;
            transition: all 0.3s ease;
            text-shadow: var(--time-text-shadow);
            font-weight: 900;
            line-height: 1;
        }

        #top-fixed-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px 20px;
            box-sizing: border-box;
            z-index: 1000;
            background-color: transparent; 
            pointer-events: none; 
        }
        
        #back-to-home-btn {
            position: fixed;
            top: 20px;
            left: 20px; 
            z-index: 1000;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            pointer-events: auto; 
        }

        /* æ–°å¢å¤œé—´æ¨¡å¼æŒ‰é’®æ ·å¼ */
        #night-mode-toggle-container {
            position: fixed; 
            top: 20px; 
            right: 180px; 
            z-index: 1001;
            pointer-events: auto; /* å…è®¸ç‚¹å‡» */
        }
        
        #current-time-container {
            display: flex;
            justify-content: flex-end; 
            align-items: flex-end; 
            flex-direction: column; 
            width: auto; 
            text-align: right;
            background-color: transparent;
            border: none;
            box-shadow: none;
            margin-bottom: 5px; 
            padding: 10px 0px; 
            position: fixed;
            top: 20px;
            right: 20px;
            pointer-events: none; 
        }
        
        #current-clock {
            font-size: 1.5em; 
            font-weight: 700;
            color: var(--main-color);
            align-self: flex-end; 
            margin: 0; 
            order: 1; 
            line-height: 1;
        }

        #current-date {
            font-size: 0.8em; 
            color: var(--text-color);
            order: 2; 
            margin-top: 5px;
            align-self: flex-end; 
            opacity: 0.8;
        }
        
        #home-page-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .home-card {
            cursor: pointer;
            text-align: center;
            padding: 40px 20px;
            border-radius: var(--border-radius);
            position: relative;
        }
        
        .home-card h3 {
            margin-top: 0;
            color: var(--main-color);
            font-size: 1.5em;
            text-transform: uppercase;
        }
        
        .home-card p {
            color: var(--text-color);
            opacity: 0.8;
            font-size: 0.9em;
        }
        
        .home-card:hover {
            background-color: color-mix(in srgb, var(--secondary-color) 20%, var(--paper-color));
            transform: translateY(-5px);
            box-shadow: 6px 6px 0px var(--main-color);
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        button, input[type="submit"], input[type="button"], .style-main, .style-secondary, .style-accent {
            padding: 12px 20px;
            border: var(--border-thick) solid var(--text-color);
            border-radius: var(--border-radius);
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-primary);
            text-transform: uppercase;
            background-color: var(--main-color);
            color: var(--paper-color);
            border-color: var(--main-color);
        }

        .style-main {
            background-color: var(--main-color);
            color: var(--paper-color);
            border-color: var(--main-color);
        }

        .style-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border-color: var(--secondary-color);
            box-shadow: 4px 4px 0px var(--text-color); 
        }

        .style-accent {
            background-color: var(--accent-color);
            color: var(--paper-color);
            border-color: var(--accent-color);
        }
        
        #todo-list-container {
            margin-top: 20px;
        }
        
        .todo-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed var(--secondary-color);
            transition: all 0.3s ease;
        }

        .todo-item input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.5);
            accent-color: var(--main-color);
        }

        .todo-item .todo-text {
            flex-grow: 1;
            font-size: 1.1em;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            opacity: 0.6;
            color: var(--main-color);
        }

        .todo-item button {
            padding: 5px 10px;
            font-size: 0.8em;
            text-transform: none;
            box-shadow: none;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
            text-align: center;
        }
        
        .stat-card {
            padding: 20px;
            background-color: color-mix(in srgb, var(--main-color) 10%, var(--paper-color));
            border-radius: var(--border-radius);
            border: 1px solid var(--main-color);
        }
        
        .stat-value {
            font-family: var(--mono-font-family);
            font-size: 2.5em;
            color: var(--accent-color);
            font-weight: 700;
            margin-top: 5px;
        }

        #footer-toggle-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            border-radius: 50px;
            padding: 15px 30px;
            text-transform: none;
        }

        #footer-controls {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 900px;
            z-index: 999;
            background-color: var(--paper-color);
            border: var(--border-thick) solid var(--text-color);
            box-shadow: var(--shadow-primary);
            border-radius: var(--border-radius);
            padding: 20px;
            display: none; 
            flex-direction: column;
            gap: 15px;
            transition: all 0.3s ease;
        }

        #footer-controls.active {
            display: flex;
        }

        #main-control-toggles {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .control-group {
            border-top: 1px dashed var(--secondary-color);
            padding-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }
        
        .control-group input[type="number"], 
        .control-group input[type="text"],
        .control-group input[type="datetime-local"], /* æ–°å¢: æ—¥æœŸæ—¶é—´è¾“å…¥æ¡† */
        .control-group select {
            padding: 8px;
            border: 1px solid var(--text-color);
            border-radius: var(--border-radius);
            background-color: var(--bg-color);
            color: var(--text-color);
            box-shadow: none;
            min-width: 100px;
            text-transform: none;
        }
        
        /* ç‹¬ç«‹äº .control-group çš„æ—¥æœŸ/æ—¶é—´è¾“å…¥æ¡†ç»Ÿä¸€é£æ ¼ */
        .timer-box input[type="datetime-local"] {
            padding: 10px; 
            border: var(--border-thick) solid var(--text-color);
            border-radius: var(--border-radius);
            background-color: var(--bg-color);
            color: var(--text-color);
            box-shadow: none;
            min-width: 250px;
            text-transform: none;
            box-sizing: border-box;
            width: 100%; 
            margin-top: 10px;
            font-size: 1em; /* ç¡®ä¿å­—ä½“å¤§å°æ­£å¸¸æ˜¾ç¤ºæ—¥æœŸ */
        }
        
        .control-group input[type="range"] {
            -webkit-appearance: none;
            width: 150px;
            height: 8px;
            background: var(--bg-color);
            border-radius: 5px;
            outline: none;
            margin: 0 10px;
            cursor: pointer;
        }
        
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--main-color);
            cursor: pointer;
            border: 2px solid var(--text-color);
        }

        /* æ–°å¢ï¼šç•ªèŒ„é’Ÿä»»åŠ¡ç¼–è¾‘è¡Œæ ·å¼ */
        .schedule-editor-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px dashed var(--secondary-color);
        }
        
        .schedule-editor-row input[type="number"], 
        .schedule-editor-row input[type="text"],
        .schedule-editor-row select {
            flex-grow: 0;
            width: 80px; 
            padding: 5px;
        }
        
        .schedule-editor-row span {
            font-size: 0.9em;
            color: var(--main-color);
        }

        .schedule-editor-row .name-input {
            flex-grow: 1;
            min-width: 120px;
        }

        .schedule-editor-row.running-task {
            background-color: color-mix(in srgb, var(--accent-color) 10%, var(--paper-color));
            border-left: 5px solid var(--accent-color);
            padding-left: 5px;
        }
        
        .schedule-controls-group {
            display: flex;
            gap: 5px;
            /* ç¡®ä¿æŒ‰é’®åœ¨å°å±å¹•ä¸Šä¹Ÿèƒ½å¯¹é½ */
            margin-left: auto; 
        }

        /* éšè—ä¸»é¡µç¼–è¾‘æ¨¡å¼çš„æŒ‰é’® */
        .home-edit-controls button {
            width: 30px;
            height: 30px;
            padding: 0;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* å¼ºåˆ¶éšè—é»˜è®¤å¡ç‰‡çš„ç‚¹å‡»æŒ‡ç¤ºå™¨ */
        .home-card.edit-mode {
            cursor: default;
        }

        /* -------------------------------------------------------- */
        /* === å¢å¼ºè®¾ç½®å¼€å…³æ ·å¼ (å·²å­˜åœ¨ï¼Œä¿ç•™) === */
        /* -------------------------------------------------------- */
        .toggle-switch-label {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            font-weight: normal;
        }

        .toggle-switch-input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-switch-slider {
            position: relative;
            width: 50px;
            height: 24px;
            margin-left: 10px;
            background-color: #ccc;
            border-radius: 34px;
            transition: .4s;
        }

        .toggle-switch-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            border-radius: 50%;
            transition: .4s;
        }

        .toggle-switch-input:checked + .toggle-switch-slider {
            background-color: var(--main-color);
        }

        .toggle-switch-input:focus + .toggle-switch-slider {
            box-shadow: 0 0 1px var(--main-color);
        }

        .toggle-switch-input:checked + .toggle-switch-slider:before {
            transform: translateX(26px);
        }
        
        /* æ‚¬æµ®çƒæ ·å¼ */
        #floating-progress {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: conic-gradient(var(--main-color) var(--progress), var(--secondary-color) var(--progress));
            color: var(--paper-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
            box-shadow: var(--shadow-primary);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            --progress: 0%; 
        }
        
        /* --- é˜²ä¼ªæ ‡ç­¾æ ·å¼ (æ–°å¢) --- */
        #verification-tag {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 998; /* ä½äºåº•éƒ¨è®¾ç½®æŒ‰é’® */
            font-size: 0.7em;
            padding: 5px 10px;
            background-color: var(--paper-color);
            color: var(--text-color);
            border: 1px solid var(--main-color);
            border-radius: 5px;
            opacity: 0.6;
            transition: all 0.3s ease;
            cursor: default;
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            font-family: var(--mono-font-family);
        }
        #verification-tag:hover {
            opacity: 1;
            background-color: var(--main-color);
            color: var(--paper-color);
        }

    </style>
</head>
<body>
    <audio id="timer-alarm" src="https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/ding.mp3"></audio>
    <audio id="break-music" src="https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/calm.mp3" loop></audio>

    <div id="top-fixed-elements">
        <button id="back-to-home-btn" class="style-main hidden" onclick="showPage('home-page')">ğŸ  è¿”å›ä¸»é¡µ</button>
        <div id="night-mode-toggle-container">
            <button id="night-mode-btn" class="style-secondary" onclick="toggleDarkMode()">ğŸŒ™ å¤œé—´æ¨¡å¼</button>
        </div>
        <div id="current-time-container">
            <p id="current-clock">00:00:00</p>
            <p id="current-date">YYYYå¹´MMæœˆDDæ—¥</p>
        </div>
    </div>
    
    <div class="main-wrapper">
        
        <div class="page-content" id="home-page">
            <h2>ğŸ  åŠŸèƒ½ä¸»é¡µ</h2>
            <p style="text-align: center; opacity: 0.8;">é€‰æ‹©æ‚¨éœ€è¦çš„è®¡æ—¶å™¨æˆ–åŠŸèƒ½ã€‚</p>
            <div class="controls" style="justify-content: flex-end;">
                <button id="home-edit-btn" class="style-secondary" onclick="toggleHomeEditMode()">ğŸ“ ç¼–è¾‘å¸ƒå±€</button>
            </div>
            <div id="home-page-grid">
                </div>
        </div>
        <div class="page-content" id="pomodoro-page">
            <div class="timer-box" id="pomodoro-box">
                <h2 id="pomodoro-title">ç•ªèŒ„å·¥ä½œæ³•</h2>
                <p id="class-sync-info" style="text-align: center; margin-bottom: 5px;">æ‰‹åŠ¨æ¨¡å¼</p>
                <div class="time-display" id="pomodoro-display">25:00</div>
                <p id="pomodoro-status" style="text-align: center; font-weight: 700; color: var(--accent-color);">å·¥ä½œæ—¶é—´</p>
                <div class="controls">
                    <button id="pomodoro-start-btn" class="style-accent" onclick="startPomodoro()">å¼€å§‹ / ç»§ç»­</button>
                    <button class="style-main" onclick="pausePomodoro()">æš‚åœ</button>
                    <button class="style-secondary" onclick="resetPomodoro()">é‡ç½®è½®æ¬¡</button>
                    <button class="style-main" onclick="skipPomodoro()">è·³è¿‡</button>
                    <button class="style-secondary" id="pomodoro-config-toggle-btn" onclick="togglePomodoroConfig()">è®¾ç½®æ—¶é•¿</button>
                </div>
                
                <div id="pomodoro-config-inputs" class="hidden" style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed var(--secondary-color); text-align: center;">
                    <div class="control-group" style="justify-content: center; gap: 15px; border-top: none; padding-top: 0;">
                        <label>å·¥ä½œæ—¶é•¿(åˆ†): <input type="number" id="work-duration" value="25" min="1"></label>
                        <label>çŸ­ä¼‘æ¯(åˆ†): <input type="number" id="short-break-duration" value="5" min="0"></label>
                        <label>é•¿ä¼‘æ¯(åˆ†): <input type="number" id="long-break-duration" value="20" min="0"></label>
                    </div>
                    <button class="style-main" onclick="savePomodoroConfig()" style="margin-top: 15px;">ä¿å­˜è®¾ç½®</button>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <p style="font-size: 0.9em; opacity: 0.8;">å·²å®Œæˆè½®æ¬¡: <span id="pomodoro-counter-display" style="font-weight: bold; color: var(--main-color);">0</span></p>
                    <p id="minutes-display" style="font-size: 0.9em; opacity: 0.8;">ä»Šæ—¥ä¸“æ³¨æ€»æ—¶é•¿: <span id="sync-minutes-display" style="font-weight: bold; color: var(--main-color);">0</span> åˆ†é’Ÿ</p>
                </div>
            </div>
        </div>

        <div class="page-content" id="schedule-page">
            <div class="schedule-editor-box">
                <h2>ğŸ“ ä»»åŠ¡æ—¥ç¨‹è¡¨ (ç•ªèŒ„å·¥ä½œæµ)</h2>
                <div id="schedule-list-container">
                    </div>
                <div class="controls" style="justify-content: center; gap: 10px;">
                    <button class="style-secondary" onclick="addScheduleRow()">æ·»åŠ æ–°ä»»åŠ¡</button>
                    <button class="style-main" onclick="saveSchedule()">ä¿å­˜ä»»åŠ¡è¡¨</button>
                    <button class="style-accent" onclick="resetScheduleData()">æ¸…é™¤å¹¶é‡ç½®</button>
                </div>
            </div>
        </div>
        
        <div class="page-content" id="countdown">
            <div class="timer-box">
                <h2>å€’è®¡æ—¶</h2>
                <div class="input-group hidden" id="countdown-input-group">
                    è®¾ç½®æ—¶é•¿ (ç§’): <input type="number" id="countdown-input" value="60" min="1">
                </div>
                <div class="time-display" id="countdown-display">01:00</div>
                <div class="controls">
                    <button class="style-main" onclick="toggleCountdownInput()">è®¾ç½®æ—¶é•¿</button>
                    <button class="style-accent" onclick="startCountdown()">å¼€å§‹</button>
                    <button class="style-main" onclick="pauseCountdown()">æš‚åœ</button>
                    <button class="style-main" onclick="resetCountdown()">é‡ç½®</button>
                </div>
                <h3 style="margin-top: 30px; text-align: center;">å¿«æ·å€’è®¡æ—¶</h3>
                <div class="controls">
                    <button class="style-secondary" onclick="setAndStartCountdown(300)">5åˆ†é’Ÿ</button>
                    <button class="style-secondary" onclick="setAndStartCountdown(600)">10åˆ†é’Ÿ</button>
                    <button class="style-secondary" onclick="setAndStartCountdown(1800)">30åˆ†é’Ÿ</button>
                </div>
            </div>
        </div>

        <div class="page-content" id="stopwatch-page">
            <div class="timer-box">
                <h2>â±ï¸ æ­£è®¡æ—¶ / ç§’è¡¨</h2>
                <div class="time-display" id="stopwatch-display">00:00:00</div>
                <div class="controls">
                    <button class="style-accent" onclick="startStopwatch()">å¼€å§‹</button>
                    <button class="style-main" onclick="pauseStopwatch()">æš‚åœ</button>
                    <button class="style-main" onclick="resetStopwatch()">é‡ç½®</button>
                </div>
            </div>
        </div>

        <div class="page-content" id="todo-page">
            <div class="timer-box">
                <h2>âœ… å¾…åŠäº‹é¡¹åˆ—è¡¨</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="text" id="new-todo-input" placeholder="è¾“å…¥æ–°çš„å¾…åŠäº‹é¡¹..." style="flex-grow: 1; padding: 10px; border: 1px solid var(--text-color); border-radius: var(--border-radius);">
                    <button class="style-main" onclick="addTodo()">æ·»åŠ </button>
                </div>
                <div id="todo-list-container">
                    </div>
                <div class="controls" style="margin-top: 20px; justify-content: flex-end;">
                    <button class="style-secondary" onclick="clearCompletedTodos()">æ¸…é™¤å·²å®Œæˆ</button>
                </div>
            </div>
        </div>

        <div class="page-content" id="favorites-page">
            <div class="timer-box">
                <h2>â­ æ”¶è—å¤¹/å¿«æ·é“¾æ¥</h2>
                <div id="favorites-list-container">
                    </div>
                <h3 style="margin-top: 30px; border-top: 1px dashed var(--secondary-color); padding-top: 15px;">æ·»åŠ æ–°é“¾æ¥</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <input type="text" id="new-favorite-name-input" placeholder="åç§° (ä¾‹å¦‚: å­¦ä¹ ç½‘ç«™)" style="padding: 10px;">
                    <input type="url" id="new-favorite-url-input" placeholder="URL (ä¾‹å¦‚: https://www.google.com)" style="padding: 10px;">
                    <button class="style-main" onclick="addFavorite()">ä¿å­˜é“¾æ¥</button>
                </div>
            </div>
        </div>

        <div class="page-content" id="stats-page">
            <div class="timer-box">
                <h2>ğŸ“Š ä¸“æ³¨ç»Ÿè®¡</h2>
                <div class="stat-grid">
                    <div class="stat-card">
                        <p>ç´¯è®¡å®Œæˆç•ªèŒ„é’Ÿè½®æ¬¡</p>
                        <p class="stat-value" id="stat-total-pomodoros">0</p>
                    </div>
                    <div class="stat-card">
                        <p>ä»Šæ—¥å®Œæˆç•ªèŒ„é’Ÿè½®æ¬¡</p>
                        <p class="stat-value" id="stat-daily-pomodoros">0</p>
                    </div>
                    <div class="stat-card">
                        <p>ä»Šæ—¥ä¸“æ³¨æ€»æ—¶é•¿</p>
                        <p class="stat-value" id="stat-daily-minutes">0 åˆ†é’Ÿ</p>
                    </div>
                </div>
                <h3 style="margin-top: 30px; border-top: 1px dashed var(--secondary-color); padding-top: 15px;">å†å²è®°å½•</h3>
                <div id="daily-stats-container">
                    </div>
            </div>
        </div>

        <div class="page-content" id="custom-date-page">
            <div class="timer-box">
                <h2>ğŸ¯ ç›®æ ‡æ—¥å€’è®¡æ—¶</h2>
                <div class="input-group" style="text-align: center; margin-bottom: 20px;">
                    è®¾ç½®ç›®æ ‡æ—¥æœŸå’Œæ—¶é—´: 
                    <input type="datetime-local" id="custom-target-datetime">
                </div>
                <div class="controls">
                    <button class="style-main" onclick="setCustomTargetDate()">è®¾ç½®å¹¶å¼€å§‹</button>
                    <button class="style-accent" onclick="pauseCustomCountdown()">åœæ­¢</button>
                    <button class="style-secondary" onclick="clearCustomTargetDate()">æ¸…é™¤ç›®æ ‡</button>
                </div>
                <p id="custom-countdown-detail" style="text-align: center; opacity: 0.7;">ç›®æ ‡å·²è®¾å®šã€‚</p>
                <div class="time-display" id="custom-countdown-display" style="font-size: 5em;">00å¤©00æ—¶00åˆ†00ç§’</div>
            </div>
        </div>

        <div class="page-content" id="exam-page">
            <div class="timer-box">
                <h2>ğŸ“ é«˜è€ƒå€’è®¡æ—¶ (2026-06-07 09:00:00)</h2>
                <div class="input-group" style="text-align: center; margin-bottom: 20px;">
                    å½“å‰ç›®æ ‡æ—¥æœŸ: <span id="target-date-display" style="font-weight: 700; color: var(--accent-color);"></span>
                    <div class="controls" style="margin-top: 10px;">
                        <input type="datetime-local" id="exam-new-target-datetime">
                        <button class="style-main" onclick="setNewExamTargetDate()">æ›´æ–°ç›®æ ‡æ—¥æœŸ</button>
                    </div>
                </div>
                <p id="exam-countdown-detail" style="text-align: center; opacity: 0.7;">è·ç¦»é«˜è€ƒè¿˜å‰©:</p>
                <div class="time-display" id="exam-countdown-display" style="font-size: 5em;">00å¤©00æ—¶00åˆ†00ç§’</div>
            </div>
        </div>

        <div class="page-content" id="account-page">
            <div class="timer-box">
                <h2>ğŸ‘¤ ç”¨æˆ·è´¦å·</h2>
                <div id="profile-card">
                    <div id="avatar-icon">ğŸš€</div>
                    <div id="username-display">è®¿å®¢</div>
                    <p id="login-status-text" style="opacity: 0.7;">æ‚¨å½“å‰æœªç™»å½•ã€‚</p>
                </div>
                <div class="controls" id="account-controls" style="margin-top: 30px;">
                    </div>
            </div>
        </div>
        
    </div>

    <button id="footer-toggle-button" class="style-main" onclick="toggleFooterControls()"> âš™ï¸ åº•éƒ¨è®¾ç½® </button>

    <div id="footer-controls">
        <div id="main-control-toggles">
            <button id="style-toggle-btn" class="style-main" onclick="toggleStyleInput()">è°ƒèŠ‚æ—¶é’Ÿæ ·å¼</button>
            <button id="sound-toggle-btn" class="style-main" onclick="toggleSoundControls()">è°ƒèŠ‚æç¤ºéŸ³</button>
            <button id="bg-toggle-btn" class="style-main" onclick="toggleBackgroundInput()">è‡ªå®šä¹‰èƒŒæ™¯</button>
            <button id="features-toggle-btn" class="style-secondary" onclick="toggleFeatureControls()">é«˜çº§åŠŸèƒ½</button>
        </div>

        <div class="control-group hidden" id="style-controls">
            <label for="style-selector">ä¸»é¢˜é£æ ¼:</label>
            <select id="style-selector" onchange="setTheme(this.value)">
                <option value="apple">Apple (æç®€)</option>
                <option value="macos">macOS (ç°ä»£)</option>
                <option value="win11">Windows 11 (Fluent)</option>
                <option value="win2000">Win2000 (å¤å¤)</option>
                <option value="glass">Glassmorphism (ç»ç’ƒ)</option>
                <option value="neo">Neumorphism (æ‹Ÿç‰©)</option>
                <option value="bauhaus" selected>BAHAUS (é»˜è®¤/å·¥ä¸š)</option>
                <option value="cyberpunk">Cyberpunk (èµ›åšæœ‹å…‹)</option>
                <option value="sketch">Sketch (æ‰‹ç»˜)</option>
                <option value="usagi">Usagi (å¯çˆ±)</option>
                <option value="doraemon">Doraemon (å“†å•¦Aæ¢¦)</option>
                <option value="christmas">Christmas (åœ£è¯)</option>
            </select>
            <label for="style-size-input">å¤§å°(em):</label>
            <input type="number" id="style-size-input" placeholder="é»˜è®¤ 8" min="1" max="15" onchange="applyClockStyles()">
            <label for="style-color-input">é¢œè‰²:</label>
            <input type="color" id="style-color-input" value="#0077b6" oninput="updateColorPreview(this.value)" onchange="applyClockStyles()">
            <div id="color-preview" style="width: 20px; height: 20px; border-radius: var(--border-radius); border: 1px solid var(--text-color);"></div>
            <label for="style-shadow-input">é˜´å½±(CSS):</label>
            <input type="text" id="style-shadow-input" placeholder="ä¾‹å¦‚: 2px 2px 5px #000" onchange="applyClockStyles()" style="min-width: 200px;">
            <button class="style-accent" onclick="resetClockStyles()">é‡ç½®æ ·å¼</button>
        </div>

        <div class="control-group hidden" id="sound-controls">
            <label for="volume-range">éŸ³é‡:</label>
            <input type="range" id="volume-range" min="0" max="1" step="0.05" value="1" oninput="setVolume(this.value)">
            <span id="volume-value">100%</span>
            <label for="alarm-selector">æç¤ºéŸ³:</label>
            <select id="alarm-selector" onchange="setAlarmSound(this.value)">
                <option value="https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/ding.mp3">Ding (é»˜è®¤)</option>
                <option value="https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/ring.mp3">Ring (ç”µè¯)</option>
                <option value="https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/bell.mp3">Bell (é“ƒé“›)</option>
                <option value="https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/xylophone.mp3">Xylophone (æœ¨ç´)</option>
                <option value="">é™éŸ³</option>
            </select>
            <button class="style-secondary" onclick="document.getElementById('timer-alarm').play()">è¯•å¬</button>
            <label for="break-music-selector">ä¼‘æ¯éŸ³ä¹:</label>
            <select id="break-music-selector" onchange="setBreakMusic(this.value)">
                <option value="https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/calm.mp3" selected>Calm (é»˜è®¤)</option>
                <option value="https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/nature.mp3">Nature (è‡ªç„¶)</option>
                <option value="">æ— éŸ³ä¹</option>
            </select>
        </div>
        
        <div class="control-group hidden" id="background-controls">
            <label for="bg-url-input">èƒŒæ™¯å›¾ç‰‡URL:</label>
            <input type="text" id="bg-url-input" placeholder="è¾“å…¥å›¾ç‰‡ URL (ç•™ç©ºä½¿ç”¨çº¯è‰²)" style="min-width: 250px;">
            <button class="style-main" onclick="setCustomBackground()">åº”ç”¨èƒŒæ™¯</button>
            <button class="style-accent" onclick="clearCustomBackground()">æ¸…é™¤èƒŒæ™¯</button>
        </div>

        <div class="control-group hidden" id="feature-controls">
            <label class="toggle-switch-label">
                TTSè¯­éŸ³æé†’:
                <input type="checkbox" id="toggle-tts" class="toggle-switch-input" onchange="toggleFeature('enableTTS')">
                <span class="toggle-switch-slider"></span>
            </label>
            <label class="toggle-switch-label">
                ä¼‘æ¯æ—¶è‡ªåŠ¨æš‚åœéŸ³ä¹:
                <input type="checkbox" id="toggle-autopause" class="toggle-switch-input" onchange="toggleFeature('enableAutoPause')">
                <span class="toggle-switch-slider"></span>
            </label>
            <label class="toggle-switch-label">
                å·¥ä½œ/ä¼‘æ¯æ—¶æ’­æ”¾èƒŒæ™¯éŸ³ä¹:
                <input type="checkbox" id="toggle-breakmusic" class="toggle-switch-input" onchange="toggleFeature('enableBreakMusic')">
                <span class="toggle-switch-slider"></span>
            </label>
            <button class="style-main" onclick="requestNotificationPermission()">è¯·æ±‚ç³»ç»Ÿé€šçŸ¥æƒé™</button>
        </div>
        
    </div>

    <div id="modal-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 10000;">
    </div>
    
    <div id="floating-progress" class="hidden" onclick="showPage('pomodoro-page')" title="ç‚¹å‡»æŸ¥çœ‹ç•ªèŒ„é’Ÿè¿›åº¦">
        0%
    </div>
    
    <div id="verification-tag" title="ç‰ˆæœ¬éªŒè¯ä¿¡æ¯">
        V7.4 | éªŒè¯ç : GMNI-V74-2025
    </div>

    <script>
        // =======================================================
        // === å…¨å±€å˜é‡å£°æ˜ ===
        // =======================================================
        const root = document.documentElement;
        let timerInterval = null; // ç”¨äºè®¡æ—¶å™¨çš„é€šç”¨å˜é‡

        const backToHomeBtn = document.getElementById('back-to-home-btn');
        const clockDisplay = document.getElementById('current-clock');
        const dateDisplay = document.getElementById('current-date');
        
        let features = JSON.parse(localStorage.getItem('features')) || {
            enableTTS: false,
            enableAutoPause: true,
            enableBreakMusic: true
        };

        // Pomodoro çŠ¶æ€å˜é‡
        let pomodoroMode = 'work'; // 'work', 'short-break', 'long-break'
        let pomodoroDuration; // å½“å‰é˜¶æ®µçš„æ€»æ—¶é•¿ï¼ˆç§’ï¼‰
        let pomodoroRemainingSeconds = 0;
        let pomodoroCounter = parseInt(localStorage.getItem('pomodoroCounter')) || 0;
        let pomodoroSet = parseInt(localStorage.getItem('pomodoroSet')) || 4; // å¤šå°‘è½®å·¥ä½œåé•¿ä¼‘
        let pomodoroIsRunning = false;

        // å€’è®¡æ—¶çŠ¶æ€å˜é‡
        let countdownDuration = 60; // é»˜è®¤ 60 ç§’
        let countdownRemainingSeconds = 0;
        let countdownInterval = null;

        // æ­£è®¡æ—¶çŠ¶æ€å˜é‡
        let stopwatchTime = 0;
        let stopwatchInterval = null;
        let stopwatchIsRunning = false;
        
        // è‡ªå®šä¹‰æ—¥æœŸå€’è®¡æ—¶å˜é‡
        let customDateTarget = localStorage.getItem('customDateTarget') || null;
        let customDateInterval = null;

        // é«˜è€ƒå€’è®¡æ—¶å˜é‡
        let examTargetDate = localStorage.getItem('examTargetDate') || '2026-06-07T09:00:00';
        let examCountdownInterval = null;

        // To-Do åˆ—è¡¨å˜é‡
        let todoList = JSON.parse(localStorage.getItem('todoList')) || [];

        // æ”¶è—å¤¹å˜é‡
        let favoritesList = JSON.parse(localStorage.getItem('favoritesList')) || [];

        // ç»Ÿè®¡å˜é‡
        let statistics = JSON.parse(localStorage.getItem('statistics')) || {
            totalPomodoros: 0,
            daily: {} // { 'YYYY-MM-DD': { pomodoros: 0, minutes: 0 } }
        };

        // Schedule ä»»åŠ¡æµå˜é‡
        let scheduleData = JSON.parse(localStorage.getItem('scheduleData') || '[]');
        let currentRunningTask = localStorage.getItem('currentRunningTask') || null;

        // é¦–é¡µé…ç½®
        const initialHomePages = [
            { id: 'pomodoro-page', icon: 'ğŸ…', title: 'ç•ªèŒ„é’Ÿ', description: 'ä¸“æ³¨å·¥ä½œä¸ä¼‘æ¯ï¼Œæé«˜æ•ˆç‡ã€‚' },
            { id: 'schedule-page', icon: 'ğŸ“', title: 'ä»»åŠ¡æ—¥ç¨‹è¡¨', description: 'ä»»åŠ¡é©±åŠ¨çš„ç•ªèŒ„å·¥ä½œæµã€‚' },
            { id: 'countdown', icon: 'â±ï¸', title: 'å€’è®¡æ—¶', description: 'è®¾å®šæ—¶é•¿ï¼Œè¿›è¡ŒçŸ­æœŸä¸“æ³¨ã€‚' },
            { id: 'stopwatch-page', icon: 'â²ï¸', title: 'æ­£è®¡æ—¶', description: 'è®°å½•æµé€çš„æ—¶é—´ã€‚' },
            { id: 'todo-page', icon: 'âœ…', title: 'å¾…åŠäº‹é¡¹', description: 'ç®¡ç†æ‚¨çš„æ¯æ—¥ä»»åŠ¡ã€‚' },
            { id: 'favorites-page', icon: 'â­', title: 'å¿«æ·é“¾æ¥', description: 'å¿«é€Ÿè®¿é—®å¸¸ç”¨ç½‘ç«™ã€‚' },
            { id: 'stats-page', icon: 'ğŸ“Š', title: 'ä¸“æ³¨ç»Ÿè®¡', description: 'æŸ¥çœ‹æ‚¨çš„ä¸“æ³¨æ•°æ®ã€‚' },
            { id: 'custom-date-page', icon: 'ğŸ¯', title: 'ç›®æ ‡æ—¥å€’è®¡æ—¶', description: 'è‡ªå®šä¹‰é‡å¤§æ—¥æœŸçš„å€’è®¡æ—¶ã€‚' },
            { id: 'exam-page', icon: 'ğŸ“', title: 'è€ƒè¯•å€’è®¡æ—¶', description: 'é«˜è€ƒ/å¤§è€ƒç›®æ ‡æ—¥æœŸæé†’ã€‚' },
            { id: 'account-page', icon: 'ğŸ‘¤', title: 'ç”¨æˆ·è´¦å·', description: 'è´¦å·å’Œä¸ªäººè®¾ç½®ç®¡ç†ã€‚' },
        ];
        let homepageOrder = JSON.parse(localStorage.getItem('homepageOrder')) || initialHomePages.map(p => p.id);

        // =======================================================
        // === é€šç”¨å·¥å…·å‡½æ•° ===
        // =======================================================

        /** æ ¼å¼åŒ–ç§’æ•°åˆ° MM:SS æˆ– HH:MM:SS */
        function formatTime(totalSeconds, includeHours = true) {
            if (totalSeconds < 0) totalSeconds = 0;
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            const pad = (num) => num.toString().padStart(2, '0');

            if (includeHours || hours > 0) {
                return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
            } else {
                return `${pad(minutes)}:${pad(seconds)}`;
            }
        }

        /** åœæ­¢æ‰€æœ‰è®¡æ—¶å™¨ */
        function stopAllTimers() {
            clearInterval(timerInterval);
            timerInterval = null;
            pomodoroIsRunning = false;
            clearInterval(countdownInterval);
            countdownInterval = null;
            clearInterval(stopwatchInterval);
            stopwatchInterval = null;
            stopwatchIsRunning = false;
            
            document.getElementById('pomodoro-box').style.backgroundColor = 'var(--paper-color)';
            
            // ç¡®ä¿ä¼‘æ¯éŸ³ä¹åœæ­¢
            if (features.enableBreakMusic) {
                document.getElementById('break-music').pause();
            }
        }
        
        /** æ’­æ”¾æç¤ºéŸ³ */
        function playAlarm() {
            const audio = document.getElementById('timer-alarm');
            audio.play().catch(e => console.log("Audio playback failed:", e));
        }

        /** é‡ç½®æµè§ˆå™¨æ ‡é¢˜ */
        function resetTitle() {
            document.title = "å¤šé£æ ¼è®¡æ—¶å™¨ V7.4 (é˜²ä¼ªç‰ˆ)";
        }

        /** æ›´æ–°æ‚¬æµ®çƒè¿›åº¦ */
        function updateFloatingBall(percent) {
            const ball = document.getElementById('floating-progress');
            if (percent === 0) {
                ball.classList.add('hidden');
                ball.textContent = '0%';
                ball.style.setProperty('--progress', '0%');
                return;
            }
            ball.classList.remove('hidden');
            ball.textContent = `${Math.round(percent)}%`;
            ball.style.setProperty('--progress', `${percent}%`);
        }
        
        /** è¯­éŸ³æ’­æŠ¥ */
        function speakMessage(text) {
            if (features.enableTTS && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                window.speechSynthesis.speak(utterance);
            }
        }

        /** å¼¹çª—æç¤º */
        function bauhausAlert(message) {
            const modalContainer = document.getElementById('modal-container');
            modalContainer.style.display = 'block';
            modalContainer.innerHTML = `
                <div class="modal-content timer-box" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); max-width: 400px; z-index: 10001;">
                    <h3>æç¤º</h3>
                    <p>${message}</p>
                    <div class="modal-controls" style="text-align:center;"><button class="style-main" onclick="safeModalClose()">ç¡®å®š</button></div>
                </div>
            `;
        }
        
        /** å…³é—­å¼¹çª— */
        function safeModalClose() {
            document.getElementById('modal-container').style.display = 'none';
        }

        /** è¯·æ±‚é€šçŸ¥æƒé™ */
        function requestNotificationPermission() {
            if (!("Notification" in window)) {
                bauhausAlert("å½“å‰æµè§ˆå™¨ä¸æ”¯æŒç³»ç»Ÿé€šçŸ¥ã€‚");
                return;
            }
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    bauhausAlert("ç³»ç»Ÿé€šçŸ¥æƒé™å·²æˆäºˆï¼");
                } else {
                    bauhausAlert("ç³»ç»Ÿé€šçŸ¥æƒé™è¢«æ‹’ç»ã€‚");
                }
            });
        }
        
        /** å‘é€ç³»ç»Ÿé€šçŸ¥ */
        function sendNotification(title, body) {
            if (Notification.permission === "granted") {
                new Notification(title, { body: body, icon: 'ğŸš€' });
            }
        }

        // =======================================================
        // === æ ·å¼/æ§åˆ¶å‡½æ•° ===
        // =======================================================

        function setTheme(styleName) {
            root.className = 'style-' + styleName + (root.classList.contains('dark-mode') ? ' dark-mode' : '');
            localStorage.setItem('websiteTheme', styleName);
            document.getElementById('style-selector').value = styleName;
            applyClockStyles(true); // é‡æ–°åº”ç”¨è‡ªå®šä¹‰æ ·å¼
        }
        
        function toggleDarkMode() {
            root.classList.toggle('dark-mode');
            const isDarkMode = root.classList.contains('dark-mode');
            localStorage.setItem('darkModeEnabled', isDarkMode ? 'true' : 'false');
            
            const btn = document.getElementById('night-mode-btn');
            if (isDarkMode) {
                btn.textContent = 'â˜€ï¸ æ—¥é—´æ¨¡å¼';
                btn.classList.replace('style-secondary', 'style-main');
            } else {
                btn.textContent = 'ğŸŒ™ å¤œé—´æ¨¡å¼';
                btn.classList.replace('style-main', 'style-secondary');
            }
        }

        function updateColorPreview(color) {
            document.getElementById('color-preview').style.backgroundColor = color;
        }

        function applyClockStyles(isInit = false) {
            const sizeInput = document.getElementById('style-size-input');
            const colorInput = document.getElementById('style-color-input');
            const shadowInput = document.getElementById('style-shadow-input');

            if (!isInit) {
                // ä¿å­˜éé»˜è®¤å€¼
                localStorage.setItem('clockStyleSize', sizeInput.value);
                localStorage.setItem('clockStyleColor', colorInput.value);
                localStorage.setItem('clockStyleShadow', shadowInput.value);
            }

            // åº”ç”¨è‡ªå®šä¹‰æ ·å¼
            if (sizeInput.value) {
                root.style.setProperty('--time-font-size', sizeInput.value + 'em');
            } else {
                root.style.removeProperty('--time-font-size');
            }

            if (colorInput.value) {
                root.style.setProperty('--time-font-color', colorInput.value);
                updateColorPreview(colorInput.value);
            } else {
                root.style.removeProperty('--time-font-color');
            }
            
            if (shadowInput.value) {
                root.style.setProperty('--time-text-shadow', shadowInput.value);
            } else {
                root.style.removeProperty('--time-text-shadow');
            }
        }

        function resetClockStyles() {
            localStorage.removeItem('clockStyleSize');
            localStorage.removeItem('clockStyleColor');
            localStorage.removeItem('clockStyleShadow');
            
            document.getElementById('style-size-input').value = '';
            // é»˜è®¤é¢œè‰²å’Œé˜´å½±åº”è¯¥ç”±CSSå˜é‡æ§åˆ¶ï¼Œæ­¤å¤„åªéœ€æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('style-color-input').value = '#0077b6';
            document.getElementById('style-shadow-input').value = '';
            
            // ç§»é™¤è‡ªå®šä¹‰å±æ€§ï¼Œè®©CSSå˜é‡é‡æ–°ç”Ÿæ•ˆ
            root.style.removeProperty('--time-font-size');
            root.style.removeProperty('--time-font-color');
            root.style.removeProperty('--time-text-shadow');
            
            updateColorPreview(document.getElementById('style-color-input').value);
            bauhausAlert('æ—¶é’Ÿæ ·å¼å·²é‡ç½®ä¸ºå½“å‰ä¸»é¢˜é»˜è®¤å€¼ã€‚');
        }

        function toggleFooterControls() {
            document.getElementById('footer-controls').classList.toggle('active');
            const btn = document.getElementById('footer-toggle-button');
            if (document.getElementById('footer-controls').classList.contains('active')) {
                btn.textContent = 'âŒ å…³é—­è®¾ç½®';
            } else {
                btn.textContent = 'âš™ï¸ åº•éƒ¨è®¾ç½®';
                // ç¡®ä¿æ”¶èµ·æ—¶æ‰€æœ‰å­é¢æ¿å…³é—­
                document.getElementById('style-controls').classList.add('hidden');
                document.getElementById('sound-controls').classList.add('hidden');
                document.getElementById('background-controls').classList.add('hidden');
                document.getElementById('feature-controls').classList.add('hidden');
            }
        }

        function toggleStyleInput() {
            document.getElementById('style-controls').classList.toggle('hidden');
            document.getElementById('sound-controls').classList.add('hidden');
            document.getElementById('background-controls').classList.add('hidden');
            document.getElementById('feature-controls').classList.add('hidden');
        }

        function toggleSoundControls() {
            document.getElementById('sound-controls').classList.toggle('hidden');
            document.getElementById('style-controls').classList.add('hidden');
            document.getElementById('background-controls').classList.add('hidden');
            document.getElementById('feature-controls').classList.add('hidden');
        }

        function toggleBackgroundInput() {
            document.getElementById('background-controls').classList.toggle('hidden');
            document.getElementById('style-controls').classList.add('hidden');
            document.getElementById('sound-controls').classList.add('hidden');
            document.getElementById('feature-controls').classList.add('hidden');
        }

        function toggleFeatureControls() {
            document.getElementById('feature-controls').classList.toggle('hidden');
            document.getElementById('style-controls').classList.add('hidden');
            document.getElementById('sound-controls').classList.add('hidden');
            document.getElementById('background-controls').classList.add('hidden');
        }

        function setVolume(volume) {
            const alarm = document.getElementById('timer-alarm');
            const music = document.getElementById('break-music');
            alarm.volume = volume;
            music.volume = volume;
            document.getElementById('volume-value').textContent = `${Math.round(volume * 100)}%`;
            localStorage.setItem('alarmVolume', volume);
        }

        function setAlarmSound(url) {
            document.getElementById('timer-alarm').src = url;
            localStorage.setItem('alarmSoundUrl', url);
        }

        function setBreakMusic(url) {
            const music = document.getElementById('break-music');
            music.src = url;
            localStorage.setItem('breakMusicUrl', url);
            // ç¡®ä¿æ­£åœ¨æ’­æ”¾æ—¶æ›´æ–°URL
            if (!music.paused) {
                music.pause();
                music.load();
                if (features.enableBreakMusic) {
                    music.play().catch(e => console.log("Break music play failed:", e));
                }
            }
        }
        
        function setCustomBackground() {
            const url = document.getElementById('bg-url-input').value.trim();
            if (url) {
                document.body.style.backgroundImage = `url('${url}')`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundPosition = 'center';
                root.classList.add('custom-bg-set');
                localStorage.setItem('customBackgroundUrl', url);
                bauhausAlert('è‡ªå®šä¹‰èƒŒæ™¯å·²åº”ç”¨ï¼');
            } else {
                clearCustomBackground();
            }
        }

        function clearCustomBackground() {
            document.body.style.backgroundImage = 'none';
            root.classList.remove('custom-bg-set');
            localStorage.removeItem('customBackgroundUrl');
            document.getElementById('bg-url-input').value = '';
            bauhausAlert('è‡ªå®šä¹‰èƒŒæ™¯å·²æ¸…é™¤ã€‚');
        }

        function toggleFeature(featureKey) {
            features[featureKey] = document.getElementById(`toggle-${featureKey}`).checked;
            localStorage.setItem('features', JSON.stringify(features));
            bauhausAlert(`åŠŸèƒ½ [${featureKey}] å·²${features[featureKey] ? 'å¼€å¯' : 'å…³é—­'}ã€‚`);
        }

        /** æ ¸å¿ƒé¡µé¢åˆ‡æ¢å‡½æ•° */
        function showPage(pageId) {
            // åœæ­¢æ‰€æœ‰è®¡æ—¶å™¨ï¼Œé˜²æ­¢åœ¨åˆ‡æ¢é¡µé¢æ—¶åœ¨åå°è¿è¡Œ
            stopAllTimers(); 

            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });

            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            } else {
                console.error(`Page element with ID "${pageId}" not found.`);
                // å¦‚æœé¡µé¢æ‰¾ä¸åˆ°ï¼Œåˆ™å°è¯•å›åˆ°ä¸»é¡µ
                if (pageId !== 'home-page') {
                    showPage('home-page');
                }
                return;
            }

            // æ§åˆ¶è¿”å›ä¸»é¡µæŒ‰é’®çš„æ˜¾ç¤º
            if (pageId === 'home-page') {
                backToHomeBtn.classList.add('hidden');
                resetTitle();
                updateFloatingBall(0); // éšè—æ‚¬æµ®çƒ
            } else {
                backToHomeBtn.classList.remove('hidden');
            }
            
            // æ‰§è¡Œé¡µé¢ç‰¹å®šçš„åˆå§‹åŒ–
            if (pageId === 'schedule-page') {
                renderScheduleEditor();
            } else if (pageId === 'favorites-page') {
                renderFavorites();
            } else if (pageId === 'pomodoro-page') {
                updatePomodoroDisplay();
            } else if (pageId === 'stats-page') {
                renderStatistics();
            } else if (pageId === 'todo-page') {
                renderTodos();
            } else if (pageId === 'custom-date-page') {
                initializeCustomCountdown();
            } else if (pageId === 'account-page') {
                renderAccountPage();
            } else if (pageId === 'countdown') {
                resetCountdown();
            } else if (pageId === 'stopwatch-page') {
                resetStopwatch();
            }
            
            // åº•éƒ¨æ§åˆ¶é¢æ¿è‡ªåŠ¨æ”¶èµ·
            const footerControls = document.getElementById('footer-controls');
            if (footerControls.classList.contains('active')) {
                toggleFooterControls();
            }
        }

        // =======================================================
        // === æ ¸å¿ƒè®¡æ—¶å™¨å‡½æ•° (å·²ä¿®å¤å…¨éƒ¨é€»è¾‘) ===
        // =======================================================
        
        /** æ–°å¢ï¼šåˆ‡æ¢ç•ªèŒ„é’Ÿé…ç½®è¾“å…¥çš„æ˜¾ç¤ºçŠ¶æ€ */
        function togglePomodoroConfig() {
            const configDiv = document.getElementById('pomodoro-config-inputs');
            configDiv.classList.toggle('hidden');
        }

        // --- Pomodoro ---
        function getPomodoroConfig() {
            // ä» input ä¸­è·å–å½“å‰é…ç½®å€¼ï¼ˆæ— è®ºæ˜¯å¦è¢«ä¿å­˜ï¼‰
            return {
                work: parseInt(document.getElementById('work-duration').value) * 60,
                shortBreak: parseInt(document.getElementById('short-break-duration').value) * 60,
                longBreak: parseInt(document.getElementById('long-break-duration').value) * 60
            };
        }

        function updatePomodoroColor() {
            const box = document.getElementById('pomodoro-box');
            const statusDisplay = document.getElementById('pomodoro-status');
            let color = 'var(--paper-color)';
            let statusText = '';
            
            if (pomodoroMode === 'work') {
                statusText = (currentRunningTask) ? `ä¸“æ³¨ä»»åŠ¡: ${currentRunningTask}` : 'ä¸“æ³¨å·¥ä½œ';
                statusDisplay.style.color = 'var(--accent-color)';
                // å·¥ä½œæ—¶æš‚åœä¼‘æ¯éŸ³ä¹
                if (features.enableBreakMusic && features.enableAutoPause) {
                    document.getElementById('break-music').pause();
                }
            } else if (pomodoroMode === 'short-break') {
                statusText = 'çŸ­ä¼‘æ¯';
                color = 'color-mix(in srgb, var(--pomodoro-break-color) 10%, var(--paper-color))';
                statusDisplay.style.color = 'var(--pomodoro-break-color)';
                // ä¼‘æ¯æ—¶æ’­æ”¾ä¼‘æ¯éŸ³ä¹
                if (features.enableBreakMusic) {
                    document.getElementById('break-music').play().catch(e => console.log("Break music play failed:", e));
                }
            } else if (pomodoroMode === 'long-break') {
                statusText = 'é•¿ä¼‘æ¯';
                color = 'color-mix(in srgb, var(--pomodoro-long-break-color) 10%, var(--paper-color))';
                statusDisplay.style.color = 'var(--pomodoro-long-break-color)';
                // ä¼‘æ¯æ—¶æ’­æ”¾ä¼‘æ¯éŸ³ä¹
                if (features.enableBreakMusic) {
                    document.getElementById('break-music').play().catch(e => console.log("Break music play failed:", e));
                }
            }
            box.style.backgroundColor = color;
            statusDisplay.textContent = statusText;
        }

        function incrementPomodoroStats(minutes) {
            const todayKey = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
            
            if (!statistics.daily[todayKey]) {
                statistics.daily[todayKey] = { pomodoros: 0, minutes: 0 };
            }
            
            statistics.totalPomodoros++;
            statistics.daily[todayKey].pomodoros++;
            statistics.daily[todayKey].minutes += minutes;

            localStorage.setItem('statistics', JSON.stringify(statistics));
        }

        function pomodoroCycleComplete() {
            playAlarm();
            sendNotification('è®¡æ—¶å™¨ç»“æŸ', `${document.getElementById('pomodoro-status').textContent} ç»“æŸï¼`);
            document.getElementById('pomodoro-box').classList.add('flash-animation');
            setTimeout(() => document.getElementById('pomodoro-box').classList.remove('flash-animation'), 2000);
            
            const { work, shortBreak, longBreak } = getPomodoroConfig();

            if (pomodoroMode === 'work') {
                // å·¥ä½œå®Œæˆï¼Œå¢åŠ ç»Ÿè®¡æ•°æ®
                incrementPomodoroStats(work / 60);
                pomodoroCounter++;
                localStorage.setItem('pomodoroCounter', pomodoroCounter);
                
                // åˆ‡æ¢åˆ°ä¼‘æ¯æ¨¡å¼
                if (pomodoroCounter % pomodoroSet === 0) {
                    pomodoroMode = 'long-break';
                    pomodoroRemainingSeconds = longBreak;
                    speakMessage("é•¿ä¼‘æ¯æ—¶é—´å¼€å§‹");
                } else {
                    pomodoroMode = 'short-break';
                    pomodoroRemainingSeconds = shortBreak;
                    speakMessage("çŸ­ä¼‘æ¯æ—¶é—´å¼€å§‹");
                }
            } else { // short-break æˆ– long-break ç»“æŸ
                // ä¼‘æ¯ç»“æŸï¼Œåˆ‡æ¢åˆ°å·¥ä½œæ¨¡å¼
                pomodoroMode = 'work';
                pomodoroRemainingSeconds = work;
                // æ¸…é™¤ä»»åŠ¡åŒæ­¥ä¿¡æ¯
                currentRunningTask = null;
                localStorage.removeItem('currentRunningTask');
                document.getElementById('class-sync-info').textContent = 'æ‰‹åŠ¨æ¨¡å¼';
                speakMessage("å·¥ä½œæ—¶é—´å¼€å§‹");
            }
            
            // **FIX BUG 1**: ç¡®ä¿åœ¨é‡æ–°å¯åŠ¨è®¡æ—¶å™¨å‰ï¼Œæ–°çš„æ—¶é•¿ç«‹å³æ˜¾ç¤º
            updatePomodoroDisplay(); 

            // é‡æ–°å¯åŠ¨è®¡æ—¶å™¨
            startPomodoro();
            updatePomodoroColor();
        }

        function updatePomodoro() {
            if (pomodoroRemainingSeconds <= 0) {
                stopAllTimers();
                pomodoroCycleComplete();
                return;
            }

            pomodoroRemainingSeconds--;
            
            // æ›´æ–°è¿›åº¦çƒå’Œæ ‡é¢˜
            const { work, shortBreak, longBreak } = getPomodoroConfig();
            const totalDuration = pomodoroMode === 'work' ? work : (pomodoroMode === 'short-break' ? shortBreak : longBreak);
            // ç¡®ä¿ totalDuration > 0 ä»¥é¿å…é™¤ä»¥é›¶
            const percent = totalDuration > 0 ? 100 - (pomodoroRemainingSeconds / totalDuration) * 100 : 0; 

            updatePomodoroDisplay();
            updateFloatingBall(percent);
            updateTitle(formatTime(pomodoroRemainingSeconds, false) + " - " + document.getElementById('pomodoro-status').textContent);
        }

        function updatePomodoroDisplay() {
            const display = document.getElementById('pomodoro-display');
            display.textContent = formatTime(pomodoroRemainingSeconds, false);
            
            const todayKey = new Date().toISOString().slice(0, 10);
            const todayStats = statistics.daily[todayKey] || { pomodoros: 0, minutes: 0 };
            document.getElementById('pomodoro-counter-display').textContent = todayStats.pomodoros; // æ˜¾ç¤ºä»Šæ—¥å·²å®Œæˆè½®æ¬¡
            document.getElementById('sync-minutes-display').textContent = todayStats.minutes;
        }

        function savePomodoroConfig() {
            const work = document.getElementById('work-duration').value;
            const shortBreak = document.getElementById('short-break-duration').value;
            const longBreak = document.getElementById('long-break-duration').value;
            
            localStorage.setItem('pomodoroWorkDuration', work);
            localStorage.setItem('pomodoroShortBreak', shortBreak);
            localStorage.setItem('pomodoroLongBreak', longBreak);
            
            // **FIX BUG 2**: å¦‚æœè®¡æ—¶å™¨æ²¡æœ‰è¿è¡Œï¼Œæ ¹æ®å½“å‰æ¨¡å¼æ›´æ–°å‰©ä½™æ—¶é—´å¹¶åŒæ­¥æ˜¾ç¤ºã€‚
            if (!pomodoroIsRunning) {
                const config = getPomodoroConfig(); // è·å–ç§’æ•°
                let newTime = 0;
                
                if (pomodoroMode === 'work') {
                    newTime = config.work;
                } else if (pomodoroMode === 'short-break') {
                    newTime = config.shortBreak;
                } else if (pomodoroMode === 'long-break') {
                    newTime = config.longBreak;
                }
                
                // åªæœ‰æ–°çš„æ—¶é•¿æœ‰æ•ˆæ—¶æ‰æ›´æ–°
                if (newTime > 0) {
                    pomodoroRemainingSeconds = newTime;
                    updatePomodoroDisplay();
                }
            }
            
            bauhausAlert('ç•ªèŒ„é’Ÿè®¾ç½®å·²ä¿å­˜ï¼');
        }
        
        function resetPomodoro() {
            stopAllTimers();
            pomodoroMode = 'work';
            currentRunningTask = null;
            localStorage.removeItem('currentRunningTask');
            
            // ä½¿ç”¨å½“å‰é…ç½®çš„å·¥ä½œæ—¶é•¿
            pomodoroRemainingSeconds = parseInt(document.getElementById('work-duration').value) * 60;
            
            document.getElementById('class-sync-info').textContent = 'æ‰‹åŠ¨æ¨¡å¼';
            document.getElementById('pomodoro-box').style.backgroundColor = 'var(--paper-color)';
            updatePomodoroColor(); // é‡ç½®çŠ¶æ€æ–‡æœ¬
            updatePomodoroDisplay();
            resetTitle();
        }

        function startPomodoro() {
            if (pomodoroIsRunning) return;
            
            const workDuration = parseInt(document.getElementById('work-duration').value) * 60;

            if (pomodoroRemainingSeconds <= 0) {
                // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨æˆ–æ—¶é—´å·²åˆ°ï¼Œç¡®ä¿é‡ç½®
                if (pomodoroMode === 'work') {
                    pomodoroRemainingSeconds = workDuration;
                } else {
                    // å¦‚æœåœ¨ä¼‘æ¯æ—¶é—´åˆ°0æ—¶ç‚¹å‡»ï¼Œåˆ™ç›´æ¥è·³åˆ°ä¸‹ä¸€ä¸ªå·¥ä½œå‘¨æœŸ
                    pomodoroCycleComplete(); 
                    return;
                }
            }

            pomodoroIsRunning = true;
            clearInterval(timerInterval);
            timerInterval = setInterval(updatePomodoro, 1000);
            
            updatePomodoroColor(); // æ›´æ–°é¢œè‰²å’ŒçŠ¶æ€æ–‡æœ¬
            speakMessage(`å¼€å§‹${document.getElementById('pomodoro-status').textContent}`);
        }

        function pausePomodoro() {
            if (!pomodoroIsRunning) return;
            
            stopAllTimers();
            pomodoroIsRunning = false;
            
            updateTitle("æš‚åœ - ç•ªèŒ„é’Ÿ");
            speakMessage("ç•ªèŒ„é’Ÿæš‚åœ");
            document.getElementById('pomodoro-box').style.backgroundColor = 'color-mix(in srgb, var(--secondary-color) 10%, var(--paper-color))';
        }

        function skipPomodoro() {
            if (pomodoroIsRunning) {
                // å¦‚æœæ­£åœ¨è¿è¡Œï¼Œè§†ä¸ºå½“å‰é˜¶æ®µå®Œæˆ
                pomodoroRemainingSeconds = 0;
                updatePomodoro(); // ç«‹å³è§¦å‘å®Œæˆé€»è¾‘
            } else {
                // å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œæ‰‹åŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µå¹¶é‡ç½®æ—¶é•¿
                const { work, shortBreak, longBreak } = getPomodoroConfig();
                
                if (pomodoroMode === 'work') {
                    pomodoroMode = 'short-break';
                    pomodoroRemainingSeconds = shortBreak;
                    pomodoroCounter++; // ä¹Ÿè¦å¢åŠ è½®æ¬¡è®¡æ•°
                    localStorage.setItem('pomodoroCounter', pomodoroCounter);
                } else if (pomodoroMode === 'short-break') {
                    pomodoroMode = (pomodoroCounter % pomodoroSet === 0) ? 'long-break' : 'work';
                    pomodoroRemainingSeconds = pomodoroMode === 'long-break' ? longBreak : work;
                } else if (pomodoroMode === 'long-break') {
                    pomodoroMode = 'work';
                    pomodoroRemainingSeconds = work;
                    currentRunningTask = null; // è·³è¿‡ä¼‘æ¯ä¹Ÿåº”è¯¥æ¸…é™¤ä»»åŠ¡
                    localStorage.removeItem('currentRunningTask');
                }
                
                stopAllTimers();
                updatePomodoroColor();
                updatePomodoroDisplay();
                updateFloatingBall(0); // é‡ç½®è¿›åº¦çƒ
                speakMessage(`è·³è¿‡ã€‚åˆ‡æ¢åˆ°${document.getElementById('pomodoro-status').textContent}`);
            }
        }

        // --- Countdown ---
        
        function updateCountdown() {
            if (countdownRemainingSeconds <= 0) {
                stopAllTimers();
                playAlarm();
                sendNotification('å€’è®¡æ—¶ç»“æŸ', 'æ‚¨è®¾å®šçš„å€’è®¡æ—¶å·²å®Œæˆï¼');
                document.getElementById('countdown-display').style.color = 'var(--accent-color)';
                speakMessage("å€’è®¡æ—¶ç»“æŸ");
                return;
            }
            countdownRemainingSeconds--;
            document.getElementById('countdown-display').textContent = formatTime(countdownRemainingSeconds, false);
            updateTitle(formatTime(countdownRemainingSeconds, false) + " - å€’è®¡æ—¶");
        }

        /** å¼€å§‹å€’è®¡æ—¶ */
        function startCountdown() {
            stopAllTimers(); // ç¡®ä¿å…¶ä»–è®¡æ—¶å™¨åœæ­¢
            const inputVal = parseInt(document.getElementById('countdown-input').value);
            const inputGroup = document.getElementById('countdown-input-group');
            
            if (!inputGroup.classList.contains('hidden')) {
                // å¦‚æœè¾“å…¥æ¡†å¯è§ï¼Œä½¿ç”¨æ–°çš„è¾“å…¥å€¼
                if (inputVal > 0) {
                    countdownDuration = inputVal;
                    countdownRemainingSeconds = countdownDuration;
                    inputGroup.classList.add('hidden');
                } else {
                    bauhausAlert('è¯·è¾“å…¥ä¸€ä¸ªå¤§äº0çš„å€’è®¡æ—¶æ—¶é•¿ã€‚');
                    return;
                }
            } else if (countdownRemainingSeconds <= 0) {
                countdownRemainingSeconds = countdownDuration;
            }
            
            if (countdownRemainingSeconds <= 0) {
                bauhausAlert('è¯·å…ˆè®¾ç½®ä¸€ä¸ªå¤§äº0çš„å€’è®¡æ—¶æ—¶é•¿ã€‚');
                return;
            }
            
            clearInterval(countdownInterval);
            countdownInterval = setInterval(updateCountdown, 1000);
            updateCountdown();
            document.getElementById('countdown-display').style.color = 'var(--main-color)';
            speakMessage("å€’è®¡æ—¶å¼€å§‹");
        }

        /** æš‚åœå€’è®¡æ—¶ */
        function pauseCountdown() {
            if (countdownInterval !== null) {
                clearInterval(countdownInterval);
                countdownInterval = null;
                updateTitle("æš‚åœ - å€’è®¡æ—¶");
                speakMessage("å€’è®¡æ—¶æš‚åœ");
                document.getElementById('countdown-display').style.color = 'var(--secondary-color)';
            }
        }

        /** é‡ç½®å€’è®¡æ—¶ */
        function resetCountdown() {
            stopAllTimers();
            countdownRemainingSeconds = countdownDuration;
            document.getElementById('countdown-display').textContent = formatTime(countdownRemainingSeconds, false);
            document.getElementById('countdown-input-group').classList.add('hidden');
            document.getElementById('countdown-display').style.color = 'var(--time-font-color)';
            resetTitle();
        }

        /** å¿«æ·è®¾ç½®å¹¶å¯åŠ¨ */
        function setAndStartCountdown(seconds) {
            countdownDuration = seconds;
            resetCountdown();
            startCountdown();
        }

        /** åˆ‡æ¢æ—¶é•¿è¾“å…¥æ¡† */
        function toggleCountdownInput() {
            document.getElementById('countdown-input-group').classList.toggle('hidden');
        }

        // --- Stopwatch ---
        function updateStopwatch() {
            stopwatchTime++;
            document.getElementById('stopwatch-display').textContent = formatTime(stopwatchTime);
            updateTitle(formatTime(stopwatchTime) + " - æ­£è®¡æ—¶");
        }

        function startStopwatch() {
            if (stopwatchIsRunning) return;
            stopAllTimers(); // ç¡®ä¿å…¶ä»–è®¡æ—¶å™¨åœæ­¢
            stopwatchIsRunning = true;
            clearInterval(stopwatchInterval);
            stopwatchInterval = setInterval(updateStopwatch, 1000);
            speakMessage("æ­£è®¡æ—¶å¼€å§‹");
        }

        function pauseStopwatch() {
            if (!stopwatchIsRunning) return;
            stopAllTimers();
            stopwatchIsRunning = false;
            updateTitle("æš‚åœ - æ­£è®¡æ—¶");
            speakMessage("æ­£è®¡æ—¶æš‚åœ");
        }

        function resetStopwatch() {
            stopAllTimers();
            stopwatchTime = 0;
            document.getElementById('stopwatch-display').textContent = formatTime(stopwatchTime);
            resetTitle();
        }

        // --- Custom Date Countdown ---
        function updateCustomCountdown() {
            const targetTime = new Date(customDateTarget).getTime();
            const now = new Date().getTime();
            let distance = targetTime - now;

            const display = document.getElementById('custom-countdown-display');
            const detail = document.getElementById('custom-countdown-detail');

            if (distance < 0) {
                display.textContent = "ç›®æ ‡æ—¥æœŸå·²åˆ°è¾¾ï¼";
                detail.textContent = "å·²å®Œæˆã€‚";
                display.style.color = 'var(--accent-color)';
                clearInterval(customDateInterval);
                playAlarm();
                sendNotification('ç›®æ ‡æ—¥åˆ°è¾¾', 'è‡ªå®šä¹‰ç›®æ ‡æ—¥æœŸå·²åˆ°è¾¾ï¼');
                speakMessage("ç›®æ ‡æ—¥åˆ°è¾¾");
                updateTitle("ç›®æ ‡æ—¥åˆ°è¾¾");
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            const pad = (num) => num.toString().padStart(2, '0');
            
            display.textContent = `${pad(days)}å¤©${pad(hours)}æ—¶${pad(minutes)}åˆ†${pad(seconds)}ç§’`;
            detail.textContent = `è·ç¦» ${new Date(customDateTarget).toLocaleString()} è¿˜å‰©:`;
            updateTitle(`${pad(days)}å¤©${pad(hours)}æ—¶ - ç›®æ ‡æ—¥å€’è®¡æ—¶`);
            display.style.color = 'var(--main-color)';
        }

        function initializeCustomCountdown() {
            const detail = document.getElementById('custom-countdown-detail');
            const display = document.getElementById('custom-countdown-display');
            display.style.color = 'var(--time-font-color)';
            
            if (customDateTarget) {
                document.getElementById('custom-target-datetime').value = customDateTarget.slice(0, 16); // å¡«å……è¾“å…¥æ¡†
                detail.textContent = `è·ç¦» ${new Date(customDateTarget).toLocaleString()} è¿˜å‰©:`;
                customDateInterval = setInterval(updateCustomCountdown, 1000);
                updateCustomCountdown();
            } else {
                detail.textContent = "è¯·è®¾ç½®æ‚¨çš„ç›®æ ‡æ—¥æœŸå’Œæ—¶é—´ã€‚";
                display.textContent = "00å¤©00æ—¶00åˆ†00ç§’";
            }
        }
        
        function setCustomTargetDate() {
            stopAllTimers();
            const input = document.getElementById('custom-target-datetime').value;
            if (!input) {
                bauhausAlert('è¯·é€‰æ‹©ä¸€ä¸ªç›®æ ‡æ—¥æœŸå’Œæ—¶é—´ã€‚');
                return;
            }
            
            customDateTarget = input;
            localStorage.setItem('customDateTarget', customDateTarget);
            
            clearInterval(customDateInterval);
            customDateInterval = setInterval(updateCustomCountdown, 1000);
            updateCustomCountdown();
            
            bauhausAlert('ç›®æ ‡æ—¥æœŸå·²è®¾ç½®å¹¶å¼€å§‹å€’è®¡æ—¶ï¼');
            speakMessage("ç›®æ ‡æ—¥å€’è®¡æ—¶å¼€å§‹");
        }

        function clearCustomTargetDate() {
            pauseCustomCountdown(); // åœæ­¢å€’è®¡æ—¶
            customDateTarget = null;
            localStorage.removeItem('customDateTarget');
            initializeCustomCountdown();
            bauhausAlert('ç›®æ ‡æ—¥æœŸå·²æ¸…é™¤ã€‚');
        }

        function pauseCustomCountdown() {
            clearInterval(customDateInterval);
            document.getElementById('custom-countdown-display').style.color = 'var(--secondary-color)';
            updateTitle("æš‚åœ - ç›®æ ‡æ—¥å€’è®¡æ—¶");
        }

        // --- Exam Countdown --- 
        function updateExamCountdown() {
            const targetTime = new Date(examTargetDate).getTime();
            const now = new Date().getTime();
            let distance = targetTime - now;

            const display = document.getElementById('exam-countdown-display');

            if (distance < 0) {
                display.textContent = "è€ƒè¯•å·²å¼€å§‹ï¼";
                clearInterval(examCountdownInterval);
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            const pad = (num) => num.toString().padStart(2, '0');
            
            display.textContent = `${pad(days)}å¤©${pad(hours)}æ—¶${pad(minutes)}åˆ†${pad(seconds)}ç§’`;
            updateTitle(`${pad(days)}å¤©${pad(hours)}æ—¶ - è€ƒè¯•å€’è®¡æ—¶`);
        }

        function setNewExamTargetDate() {
            const input = document.getElementById('exam-new-target-datetime').value;
            if (!input) {
                bauhausAlert('è¯·é€‰æ‹©ä¸€ä¸ªç›®æ ‡æ—¥æœŸå’Œæ—¶é—´ã€‚');
                return;
            }
            
            examTargetDate = input;
            localStorage.setItem('examTargetDate', examTargetDate);
            document.getElementById('target-date-display').textContent = examTargetDate.replace('T', ' ');
            
            clearInterval(examCountdownInterval);
            examCountdownInterval = setInterval(updateExamCountdown, 1000);
            updateExamCountdown();
            
            bauhausAlert('é«˜è€ƒ/è€ƒè¯•ç›®æ ‡æ—¥æœŸå·²æ›´æ–°ï¼');
        }

        // --- To-Do List ---
        function saveTodos() {
            localStorage.setItem('todoList', JSON.stringify(todoList));
        }

        function toggleTodoComplete(index) {
            todoList[index].completed = !todoList[index].completed;
            saveTodos();
            renderTodos();
        }

        function deleteTodo(index) {
            todoList.splice(index, 1);
            saveTodos();
            renderTodos();
        }

        function renderTodos() {
            const container = document.getElementById('todo-list-container');
            container.innerHTML = '';
            
            if (todoList.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7;">æš‚æ— å¾…åŠäº‹é¡¹ã€‚</p>';
                return;
            }

            todoList.forEach((todo, index) => {
                const item = document.createElement('div');
                item.className = `todo-item ${todo.completed ? 'completed' : ''}`;
                
                // ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²æ¥åˆ›å»ºå…ƒç´ ï¼Œå¹¶ç»‘å®šäº‹ä»¶
                item.innerHTML = `
                    <input type="checkbox" onchange="toggleTodoComplete(${index})" ${todo.completed ? 'checked' : ''}>
                    <span class="todo-text">${todo.text}</span>
                    <button class="style-accent" onclick="deleteTodo(${index})">åˆ é™¤</button>
                `;
                container.appendChild(item);
            });
        }

        function addTodo() {
            const input = document.getElementById('new-todo-input');
            const text = input.value.trim();
            if (text) {
                todoList.push({ text: text, completed: false });
                input.value = '';
                saveTodos();
                renderTodos();
            } else {
                bauhausAlert('è¯·è¾“å…¥å¾…åŠäº‹é¡¹å†…å®¹ã€‚');
            }
        }

        function clearCompletedTodos() {
            const originalLength = todoList.length;
            todoList = todoList.filter(todo => !todo.completed);
            
            if (todoList.length < originalLength) {
                saveTodos();
                renderTodos();
                bauhausAlert('å·²æ¸…é™¤æ‰€æœ‰å·²å®Œæˆçš„å¾…åŠäº‹é¡¹ã€‚');
            } else {
                bauhausAlert('æ²¡æœ‰å·²å®Œæˆçš„å¾…åŠäº‹é¡¹ã€‚');
            }
        }

        // --- Favorites (å¿«æ·é“¾æ¥) ---
        function saveFavorites() {
            localStorage.setItem('favoritesList', JSON.stringify(favoritesList));
        }

        function deleteFavorite(index) {
            favoritesList.splice(index, 1);
            saveFavorites();
            renderFavorites();
        }

        function renderFavorites() {
            const container = document.getElementById('favorites-list-container');
            container.innerHTML = '';
            
            if (favoritesList.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7;">æš‚æ— æ”¶è—é“¾æ¥ã€‚</p>';
                return;
            }

            const ul = document.createElement('ul');
            ul.style.listStyle = 'none';
            ul.style.padding = '0';
            
            favoritesList.forEach((fav, index) => {
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.alignItems = 'center';
                li.style.padding = '10px 0';
                li.style.borderBottom = '1px dashed var(--secondary-color)';
                
                const link = document.createElement('a');
                link.href = fav.url;
                link.target = '_blank';
                link.textContent = `${fav.name} (${fav.url})`;
                link.style.flexGrow = '1';
                link.style.textDecoration = 'none';
                link.style.color = 'var(--main-color)';

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'style-accent';
                deleteBtn.textContent = 'åˆ é™¤';
                deleteBtn.style.marginLeft = '15px';
                deleteBtn.style.padding = '5px 10px';
                deleteBtn.style.fontSize = '0.8em';
                deleteBtn.onclick = () => deleteFavorite(index);

                li.appendChild(link);
                li.appendChild(deleteBtn);
                ul.appendChild(li);
            });
            container.appendChild(ul);
        }

        function addFavorite() {
            const nameInput = document.getElementById('new-favorite-name-input');
            const urlInput = document.getElementById('new-favorite-url-input');
            const name = nameInput.value.trim();
            
            if (name && urlInput.value.trim()) {
                favoritesList.push({ name: name, url: urlInput.value.trim() }); // ä¿å­˜åŸå§‹è¾“å…¥URL
                nameInput.value = '';
                urlInput.value = '';
                saveFavorites();
                renderFavorites();
                bauhausAlert('é“¾æ¥å·²æ·»åŠ åˆ°æ”¶è—å¤¹ï¼');
            } else {
                bauhausAlert('åç§°å’Œ URL éƒ½ä¸èƒ½ä¸ºç©ºã€‚');
            }
        }

        // --- Statistics ---
        
        function renderStatistics() {
            const todayKey = new Date().toISOString().slice(0, 10);
            const todayStats = statistics.daily[todayKey] || { pomodoros: 0, minutes: 0 };
            
            document.getElementById('stat-total-pomodoros').textContent = statistics.totalPomodoros;
            document.getElementById('stat-daily-pomodoros').textContent = todayStats.pomodoros;
            document.getElementById('stat-daily-minutes').textContent = `${todayStats.minutes} åˆ†é’Ÿ`;

            const historyContainer = document.getElementById('daily-stats-container');
            historyContainer.innerHTML = '';

            const sortedDates = Object.keys(statistics.daily).sort().reverse();
            
            sortedDates.forEach(date => {
                const dayStats = statistics.daily[date];
                const item = document.createElement('p');
                item.style.padding = '5px 0';
                item.style.borderBottom = '1px dashed var(--secondary-color)';
                item.innerHTML = `
                    <strong>${date}</strong>: å®Œæˆè½®æ¬¡ <span style="color: var(--main-color);">${dayStats.pomodoros}</span> æ¬¡ï¼Œ
                    ä¸“æ³¨æ—¶é•¿ <span style="color: var(--accent-color);">${dayStats.minutes}</span> åˆ†é’Ÿ
                `;
                historyContainer.appendChild(item);
            });
            
            if (sortedDates.length === 0) {
                historyContainer.innerHTML = '<p style="text-align: center; opacity: 0.7;">æš‚æ— å†å²è®°å½•ã€‚</p>';
            }
        }

        // --- Schedule ---

        function saveSchedule() {
            localStorage.setItem('scheduleData', JSON.stringify(scheduleData));
            bauhausAlert('ä»»åŠ¡è¡¨å·²ä¿å­˜ï¼');
            renderScheduleEditor();
        }

        function removeScheduleRow(index) {
            scheduleData.splice(index, 1);
            saveSchedule();
        }
        
        function moveScheduleRow(index, direction) {
            if (direction === 'up' && index > 0) {
                [scheduleData[index], scheduleData[index - 1]] = [scheduleData[index - 1], scheduleData[index]];
            } else if (direction === 'down' && index < scheduleData.length - 1) {
                [scheduleData[index], scheduleData[index + 1]] = [scheduleData[index + 1], scheduleData[index]];
            }
            saveSchedule();
            renderScheduleEditor();
        }
        
        function renderScheduleEditor() {
            const scheduleListContainer = document.getElementById('schedule-list-container');
            scheduleListContainer.innerHTML = '';

            if (scheduleData.length === 0) {
                scheduleListContainer.innerHTML = '<p style="text-align: center; opacity: 0.7;">æš‚æ— ä»»åŠ¡ï¼Œè¯·æ·»åŠ æ–°ä»»åŠ¡ã€‚</p>';
                return;
            }

            scheduleData.forEach((task, index) => {
                const isCurrent = currentRunningTask === task.name;
                const row = document.createElement('div');
                row.className = `schedule-editor-row ${isCurrent ? 'running-task' : ''}`;

                const nameSelect = document.createElement('input');
                nameSelect.type = 'text';
                nameSelect.className = 'name-input';
                nameSelect.value = task.name;
                nameSelect.oninput = (e) => task.name = e.target.value;

                const durationInput = document.createElement('input');
                durationInput.type = 'number';
                durationInput.value = task.duration;
                durationInput.min = '1';
                durationInput.oninput = (e) => task.duration = parseInt(e.target.value) || 25;

                const restInput = document.createElement('input');
                restInput.type = 'number';
                restInput.value = task.rest;
                restInput.min = '0';
                restInput.oninput = (e) => task.rest = parseInt(e.target.value) || 5;

                row.appendChild(nameSelect);
                row.appendChild(document.createTextNode('å·¥ä½œ: '));
                row.appendChild(durationInput);
                row.appendChild(document.createTextNode('åˆ†'));
                row.appendChild(document.createTextNode(' ä¼‘æ¯: '));
                row.appendChild(restInput);
                row.appendChild(document.createTextNode('åˆ†'));

                const controlsGroup = document.createElement('div');
                controlsGroup.className = 'schedule-controls-group';

                const startBtn = document.createElement('button');
                startBtn.className = isCurrent ? 'style-secondary' : 'style-accent';
                startBtn.textContent = isCurrent ? 'â¸ï¸ æš‚åœ' : 'â–¶ï¸ å¯åŠ¨';
                startBtn.title = 'å¯åŠ¨ä»»åŠ¡çš„ç•ªèŒ„é’Ÿ';
                startBtn.onclick = () => {
                    if (isCurrent && pomodoroIsRunning) {
                        pausePomodoro();
                    } else if (isCurrent && !pomodoroIsRunning) {
                        startPomodoro();
                    } else {
                        startPomodoroForTask(index);
                    }
                };
                
                const upBtn = document.createElement('button');
                upBtn.className = 'style-main';
                upBtn.textContent = 'â¬†ï¸';
                upBtn.onclick = () => moveScheduleRow(index, 'up');
                upBtn.disabled = index === 0;

                const downBtn = document.createElement('button');
                downBtn.className = 'style-main';
                downBtn.textContent = 'â¬‡ï¸';
                downBtn.onclick = () => moveScheduleRow(index, 'down');
                downBtn.disabled = index === scheduleData.length - 1;

                const removeBtn = document.createElement('button');
                removeBtn.className = 'style-accent';
                removeBtn.textContent = 'ç§»é™¤';
                removeBtn.onclick = () => removeScheduleRow(index);
                
                controlsGroup.appendChild(startBtn);
                controlsGroup.appendChild(upBtn);
                controlsGroup.appendChild(downBtn);
                controlsGroup.appendChild(removeBtn);
                
                row.appendChild(controlsGroup);
                scheduleListContainer.appendChild(row);
            });
        }
        
        function addScheduleRow() {
            scheduleData.push({ name: 'æ–°ä»»åŠ¡', duration: 25, rest: 5 });
            saveSchedule();
        }
        
        function resetScheduleData() {
            scheduleData = [];
            currentRunningTask = null;
            localStorage.removeItem('currentRunningTask');
            saveSchedule();
            bauhausAlert('ä»»åŠ¡è¡¨å·²æ¸…é™¤ã€‚');
        }

        function startPomodoroForTask(index) {
            const task = scheduleData[index];
            if (!task) return;
            
            stopAllTimers();

            currentRunningTask = task.name;
            localStorage.setItem('currentRunningTask', currentRunningTask);
            
            pomodoroMode = 'work';
            pomodoroRemainingSeconds = task.duration * 60;

            // ç¡®ä¿ Pomodoro é¡µé¢æ˜¾ç¤ºé…ç½®åŒ¹é…
            document.getElementById('work-duration').value = task.duration;
            document.getElementById('short-break-duration').value = task.rest;
            document.getElementById('long-break-duration').value = task.rest;
            
            // BUG ä¿®å¤ #1: ä»»åŠ¡å¯åŠ¨æ—¶ï¼Œéœ€è¦å°†æ–°çš„ä»»åŠ¡æ—¶é•¿ä¿å­˜ä¸º Pomodoro é…ç½®ï¼Œ
            // å¦åˆ™åœ¨ç¬¬ä¸€ä¸ªå·¥ä½œå‘¨æœŸç»“æŸåï¼Œä¸‹ä¸€ä¸ªä¼‘æ¯å‘¨æœŸå°†ä½¿ç”¨æ—§çš„é»˜è®¤å€¼æˆ–ä¿å­˜å€¼ã€‚
            savePomodoroConfig(); 
            
            // æ˜¾ç¤ºåŒæ­¥ä¿¡æ¯
            document.getElementById('class-sync-info').textContent = `æ­£åœ¨è¿è¡Œä»»åŠ¡: ${task.name}`;

            // åˆ‡æ¢åˆ° Pomodoro é¡µé¢å¹¶å¯åŠ¨
            showPage('pomodoro-page');
            startPomodoro();
        }

        // --- Home Page ---

        function saveHomePageOrder() {
            const order = Array.from(document.querySelectorAll('.home-card')).map(card => card.getAttribute('data-page-id'));
            localStorage.setItem('homepageOrder', JSON.stringify(order));
        }

        function moveHomePageCard(pageId, direction) {
            const index = homepageOrder.indexOf(pageId);
            if (direction === 'up' && index > 0) {
                [homepageOrder[index], homepageOrder[index - 1]] = [homepageOrder[index - 1], homepageOrder[index]];
            } else if (direction === 'down' && index < homepageOrder.length - 1) {
                [homepageOrder[index], homepageOrder[index + 1]] = [homepageOrder[index + 1], homepageOrder[index]];
            }
            saveHomePageOrder();
            renderHomePage(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°æŒ‰é’®çŠ¶æ€å’Œä½ç½®
        }

        function renderHomePage() {
            const grid = document.getElementById('home-page-grid');
            grid.innerHTML = '';
            
            const pagesMap = initialHomePages.reduce((map, page) => {
                map[page.id] = page;
                return map;
            }, {});

            homepageOrder.forEach(pageId => {
                const page = pagesMap[pageId];
                if (!page) return;

                const card = document.createElement('div');
                card.className = 'home-card';
                card.setAttribute('data-page-id', page.id);
                card.onclick = () => showPage(page.id);

                const editControls = document.createElement('div');
                editControls.className = 'home-edit-controls hidden';
                editControls.style.cssText = 'position: absolute; top: 10px; right: 10px; display: flex; flex-direction: column; gap: 5px;';
                editControls.style.pointerEvents = 'auto';

                const upBtn = document.createElement('button');
                upBtn.className = 'style-secondary home-move-btn';
                upBtn.textContent = 'â¬†ï¸';
                upBtn.title = 'ä¸Šç§»';
                upBtn.disabled = homepageOrder.indexOf(page.id) === 0;
                upBtn.onclick = (e) => {
                    e.stopPropagation();
                    moveHomePageCard(page.id, 'up');
                };

                const downBtn = document.createElement('button');
                downBtn.className = 'style-secondary home-move-btn';
                downBtn.textContent = 'â¬‡ï¸';
                downBtn.title = 'ä¸‹ç§»';
                downBtn.disabled = homepageOrder.indexOf(page.id) === homepageOrder.length - 1;
                downBtn.onclick = (e) => {
                    e.stopPropagation();
                    moveHomePageCard(page.id, 'down');
                };

                editControls.appendChild(upBtn);
                editControls.appendChild(downBtn);

                card.innerHTML = `<h3>${page.icon} ${page.title}</h3><p>${page.description}</p>`;
                card.appendChild(editControls);

                grid.appendChild(card);
            });
            
            if (document.getElementById('home-page').classList.contains('edit-mode')) {
                toggleHomeEditMode(true);
            }
        }

        function toggleHomeEditMode(forceEnable = false) {
            const homePage = document.getElementById('home-page');
            const cards = homePage.querySelectorAll('.home-card');
            const editControls = homePage.querySelectorAll('.home-edit-controls');
            const editBtn = document.getElementById('home-edit-btn');
            const isEditing = homePage.classList.contains('edit-mode');

            if (!isEditing || forceEnable) {
                homePage.classList.add('edit-mode');
                editControls.forEach(c => c.classList.remove('hidden'));
                cards.forEach(card => card.onclick = null); // ç§»é™¤ç‚¹å‡»äº‹ä»¶
                editBtn.textContent = 'å®Œæˆç¼–è¾‘';
                editBtn.classList.replace('style-secondary', 'style-accent');
                bauhausAlert('ä¸»é¡µå·²è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œç‚¹å‡»ä¸Šä¸‹ç®­å¤´å¯è°ƒæ•´å¡ç‰‡é¡ºåºã€‚');
            } else {
                homePage.classList.remove('edit-mode');
                editControls.forEach(c => c.classList.add('hidden'));
                cards.forEach(card => {
                    const pageId = card.getAttribute('data-page-id');
                    card.onclick = () => showPage(pageId); // æ¢å¤ç‚¹å‡»äº‹ä»¶
                });
                editBtn.textContent = 'ğŸ“ ç¼–è¾‘å¸ƒå±€';
                editBtn.classList.replace('style-accent', 'style-secondary');
                bauhausAlert('ä¸»é¡µå¸ƒå±€å·²ä¿å­˜ã€‚');
            }
        }

        // --- Account Page (Placeholder functions) ---
        function renderAccountPage() {
            // Placeholder: Implement user profile and login/logout logic here
            const controls = document.getElementById('account-controls');
            controls.innerHTML = `
                <button class="style-main" onclick="bauhausAlert('åŠŸèƒ½å¼€å‘ä¸­...')">ç™»å½•</button>
                <button class="style-secondary" onclick="bauhausAlert('åŠŸèƒ½å¼€å‘ä¸­...')">æ³¨å†Œ</button>
            `;
        }

        // =======================================================
        // === æ—¶é’Ÿå’Œåˆå§‹åŒ– ===
        // =======================================================

        function updateClock() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            const dateStr = `${now.getFullYear()}å¹´${(now.getMonth() + 1).toString().padStart(2, '0')}æœˆ${now.getDate().toString().padStart(2, '0')}æ—¥`;

            clockDisplay.textContent = `${hours}:${minutes}:${seconds}`;
            dateDisplay.textContent = dateStr;
        }

        function updateTitle(newTitle) {
            document.title = newTitle;
        }

        function initialize() {
            // é»˜è®¤ä¸»é¢˜å’Œå¤œé—´æ¨¡å¼åŠ è½½
            const savedTheme = localStorage.getItem('websiteTheme') || 'bauhaus';
            const isDarkMode = localStorage.getItem('darkModeEnabled') === 'true';

            setTheme(savedTheme);
            if (isDarkMode) {
                root.classList.add('dark-mode');
                document.getElementById('night-mode-btn').textContent = 'â˜€ï¸ æ—¥é—´æ¨¡å¼';
            } else {
                document.getElementById('night-mode-btn').textContent = 'ğŸŒ™ å¤œé—´æ¨¡å¼';
            }

            // æ—¶é’Ÿ
            setInterval(updateClock, 1000);
            updateClock();

            // åŠ è½½éŸ³é‡å’Œå£°éŸ³è®¾ç½®
            const savedVolume = localStorage.getItem('alarmVolume') || '1';
            const savedAlarmUrl = localStorage.getItem('alarmSoundUrl') || "https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/ding.mp3";
            const savedMusicUrl = localStorage.getItem('breakMusicUrl') || "https://cdn.jsdelivr.net/gh/tars-dev/cdn/sounds/calm.mp3";
            
            document.getElementById('volume-range').value = savedVolume;
            setVolume(savedVolume);
            document.getElementById('alarm-selector').value = savedAlarmUrl;
            document.getElementById('timer-alarm').src = savedAlarmUrl;
            document.getElementById('break-music-selector').value = savedMusicUrl;
            document.getElementById('break-music').src = savedMusicUrl;

            // åŠ è½½è‡ªå®šä¹‰æ—¶é’Ÿæ ·å¼
            const savedSize = localStorage.getItem('clockStyleSize');
            const savedColor = localStorage.getItem('clockStyleColor');
            const savedShadow = localStorage.getItem('clockStyleShadow');

            if (savedSize !== null) {
                 document.getElementById('style-size-input').value = savedSize;
            }
            if (savedColor !== null) {
                 document.getElementById('style-color-input').value = savedColor;
                 updateColorPreview(savedColor);
            }
            if (savedShadow !== null) {
                 document.getElementById('style-shadow-input').value = savedShadow;
            }
            
            applyClockStyles(true); 
            
            const savedBgUrl = localStorage.getItem('customBackgroundUrl');
            if (savedBgUrl) {
                document.getElementById('bg-url-input').value = savedBgUrl;
                setCustomBackground();
            }
            
            // åˆå§‹åŒ– Toggle çŠ¶æ€
            document.getElementById('toggle-tts').checked = features.enableTTS;
            document.getElementById('toggle-autopause').checked = features.enableAutoPause;
            document.getElementById('toggle-breakmusic').checked = features.enableBreakMusic;
            
            // åˆå§‹åŒ– Pomodoro é…ç½®è¾“å…¥æ¡†çš„å€¼
            document.getElementById('work-duration').value = localStorage.getItem('pomodoroWorkDuration') || '25';
            document.getElementById('short-break-duration').value = localStorage.getItem('pomodoroShortBreak') || '5';
            document.getElementById('long-break-duration').value = localStorage.getItem('pomodoroLongBreak') || '20';
            
            // åˆå§‹åŒ–è®¡æ—¶å™¨
            resetCountdown();
            resetStopwatch();
            resetPomodoro();
            
            // åˆå§‹åŒ–è‡ªå®šä¹‰å€’è®¡æ—¶å’Œé«˜è€ƒå€’è®¡æ—¶
            initializeCustomCountdown(); 
            document.getElementById('target-date-display').textContent = examTargetDate.replace('T', ' ');
            examCountdownInterval = setInterval(updateExamCountdown, 1000);
            updateExamCountdown(); 
            
            // é»˜è®¤æ˜¾ç¤ºä¸»é¡µ - ä½¿ç”¨æ–°å¢çš„æ¸²æŸ“å‡½æ•°
            renderHomePage(); 
            showPage('home-page'); 
        }

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>